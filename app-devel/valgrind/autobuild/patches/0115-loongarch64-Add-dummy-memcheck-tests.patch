From 07cabaefa44a1163c84ea37907659a53ce6a998a Mon Sep 17 00:00:00 2001
From: Feiyang Chen <chenfeiyang@loongson.cn>
Date: Mon, 28 Mar 2022 10:45:57 +0800
Subject: [PATCH v4 115/123] loongarch64: Add dummy memcheck tests

---
 .gitignore                                      | 10 ++++++++++
 configure.ac                                    |  1 +
 memcheck/tests/Makefile.am                      |  5 ++++-
 memcheck/tests/loongarch64-linux/Makefile.am    | 17 +++++++++++++++++
 memcheck/tests/loongarch64-linux/filter_stderr  |  3 +++
 memcheck/tests/loongarch64-linux/scalar.c       |  7 +++++++
 memcheck/tests/loongarch64-linux/scalar.h       |  1 +
 .../tests/loongarch64-linux/scalar.stderr.exp   |  0
 memcheck/tests/loongarch64-linux/scalar.vgtest  |  3 +++
 9 files changed, 46 insertions(+), 1 deletion(-)
 create mode 100644 memcheck/tests/loongarch64-linux/Makefile.am
 create mode 100755 memcheck/tests/loongarch64-linux/filter_stderr
 create mode 100644 memcheck/tests/loongarch64-linux/scalar.c
 create mode 100644 memcheck/tests/loongarch64-linux/scalar.h
 create mode 100644 memcheck/tests/loongarch64-linux/scalar.stderr.exp
 create mode 100644 memcheck/tests/loongarch64-linux/scalar.vgtest

diff --git a/.gitignore b/.gitignore
index 738b4e33f..ec5dff11e 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1067,6 +1067,16 @@
 /memcheck/tests/arm64-linux/Makefile.in
 /memcheck/tests/arm64-linux/scalar
 
+# /memcheck/tests/loongarch64-linux/
+/memcheck/tests/loongarch64-linux/*.stderr.diff
+/memcheck/tests/loongarch64-linux/*.stderr.out
+/memcheck/tests/loongarch64-linux/*.stdout.diff
+/memcheck/tests/loongarch64-linux/*.stdout.out
+/memcheck/tests/loongarch64-linux/.deps
+/memcheck/tests/loongarch64-linux/Makefile
+/memcheck/tests/loongarch64-linux/Makefile.in
+/memcheck/tests/loongarch64-linux/scalar
+
 # /memcheck/tests/common/
 /memcheck/tests/common/Makefile
 /memcheck/tests/common/Makefile.in
diff --git a/configure.ac b/configure.ac
index d83154e33..5b6db1816 100755
--- a/configure.ac
+++ b/configure.ac
@@ -5391,6 +5391,7 @@ AC_CONFIG_FILES([
    memcheck/tests/amd64-linux/Makefile
    memcheck/tests/arm64-linux/Makefile
    memcheck/tests/x86-linux/Makefile
+   memcheck/tests/loongarch64-linux/Makefile
    memcheck/tests/amd64-solaris/Makefile
    memcheck/tests/x86-solaris/Makefile
    memcheck/tests/amd64-freebsd/Makefile
diff --git a/memcheck/tests/Makefile.am b/memcheck/tests/Makefile.am
index aa936ac05..63ad5d84f 100644
--- a/memcheck/tests/Makefile.am
+++ b/memcheck/tests/Makefile.am
@@ -50,6 +50,9 @@ endif
 if VGCONF_PLATFORMS_INCLUDE_ARM64_LINUX
 SUBDIRS += arm64-linux
 endif
+if VGCONF_PLATFORMS_INCLUDE_LOONGARCH64_LINUX
+SUBDIRS += loongarch64-linux
+endif
 if VGCONF_PLATFORMS_INCLUDE_X86_SOLARIS
 SUBDIRS += x86-solaris
 endif
@@ -65,7 +68,7 @@ endif
 
 DIST_SUBDIRS = x86 amd64 ppc32 ppc64 s390x linux \
 		darwin solaris x86-linux amd64-linux arm64-linux \
-		x86-solaris amd64-solaris mips32 mips64 \
+		loongarch64-linux x86-solaris amd64-solaris mips32 mips64 \
 		freebsd amd64-freebsd x86-freebsd \
 		common .
 
diff --git a/memcheck/tests/loongarch64-linux/Makefile.am b/memcheck/tests/loongarch64-linux/Makefile.am
new file mode 100644
index 000000000..5afcaa4ec
--- /dev/null
+++ b/memcheck/tests/loongarch64-linux/Makefile.am
@@ -0,0 +1,17 @@
+
+include $(top_srcdir)/Makefile.tool-tests.am
+
+dist_noinst_SCRIPTS = \
+	filter_stderr
+
+noinst_HEADERS = scalar.h
+
+EXTRA_DIST = \
+	scalar.stderr.exp scalar.vgtest
+
+check_PROGRAMS = \
+	scalar
+
+AM_CFLAGS    += @FLAG_M64@
+AM_CXXFLAGS  += @FLAG_M64@
+AM_CCASFLAGS += @FLAG_M64@
diff --git a/memcheck/tests/loongarch64-linux/filter_stderr b/memcheck/tests/loongarch64-linux/filter_stderr
new file mode 100755
index 000000000..a778e971f
--- /dev/null
+++ b/memcheck/tests/loongarch64-linux/filter_stderr
@@ -0,0 +1,3 @@
+#! /bin/sh
+
+../filter_stderr "$@"
diff --git a/memcheck/tests/loongarch64-linux/scalar.c b/memcheck/tests/loongarch64-linux/scalar.c
new file mode 100644
index 000000000..3bdaac2fa
--- /dev/null
+++ b/memcheck/tests/loongarch64-linux/scalar.c
@@ -0,0 +1,7 @@
+#include "scalar.h"
+
+int main(void)
+{
+   /* TODO */
+   return 0;
+}
diff --git a/memcheck/tests/loongarch64-linux/scalar.h b/memcheck/tests/loongarch64-linux/scalar.h
new file mode 100644
index 000000000..8f414f586
--- /dev/null
+++ b/memcheck/tests/loongarch64-linux/scalar.h
@@ -0,0 +1 @@
+/* TODO */
diff --git a/memcheck/tests/loongarch64-linux/scalar.stderr.exp b/memcheck/tests/loongarch64-linux/scalar.stderr.exp
new file mode 100644
index 000000000..e69de29bb
diff --git a/memcheck/tests/loongarch64-linux/scalar.vgtest b/memcheck/tests/loongarch64-linux/scalar.vgtest
new file mode 100644
index 000000000..897d9e73c
--- /dev/null
+++ b/memcheck/tests/loongarch64-linux/scalar.vgtest
@@ -0,0 +1,3 @@
+prog: scalar
+vgopts: -q --error-limit=no
+args: < scalar.c
-- 
2.39.1

