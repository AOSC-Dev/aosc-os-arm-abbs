From 55a73a4eac6c384c7e80d65f7c82522d4094baf9 Mon Sep 17 00:00:00 2001
From: Feiyang Chen <chenfeiyang@loongson.cn>
Date: Tue, 22 Mar 2022 14:49:46 +0800
Subject: [PATCH v4 059/123] loongarch64: Add isel support for Iex_Get of
 integer expressions

---
 VEX/priv/host_loongarch64_isel.c | 25 +++++++++++++++++++++++--
 1 file changed, 23 insertions(+), 2 deletions(-)

diff --git a/VEX/priv/host_loongarch64_isel.c b/VEX/priv/host_loongarch64_isel.c
index 0382fd419..f78fdb1fe 100644
--- a/VEX/priv/host_loongarch64_isel.c
+++ b/VEX/priv/host_loongarch64_isel.c
@@ -818,8 +818,29 @@ static HReg iselIntExpr_R_wrk ( ISelEnv* env, IRExpr* e )
       }
 
       /* --------- GET --------- */
-      case Iex_Get:
-         break;
+      case Iex_Get: {
+         LOONGARCH64AMode* am = mkLOONGARCH64AMode_RI(hregGSP(), e->Iex.Get.offset);
+         HReg             dst = newVRegI(env);
+         LOONGARCH64LoadOp op;
+         switch(ty) {
+            case Ity_I8:
+               op = LAload_LD_BU;
+               break;
+            case Ity_I16:
+               op = LAload_LD_HU;
+               break;
+            case Ity_I32:
+               op = LAload_LD_WU;
+               break;
+            case Ity_I64:
+               op = LAload_LD_D;
+               break;
+            default:
+               goto irreducible;
+         }
+         addInstr(env, LOONGARCH64Instr_Load(op, am, dst));
+         return dst;
+      }
 
       /* --------- CCALL --------- */
       case Iex_CCall:
-- 
2.39.1

