From 5052eb2e6bb6c9c2b2584802951dc340cac50683 Mon Sep 17 00:00:00 2001
From: Feiyang Chen <chenfeiyang@loongson.cn>
Date: Tue, 22 Mar 2022 14:50:12 +0800
Subject: [PATCH v4 060/123] loongarch64: Add isel support for Iex_Const of
 integer expressions

---
 VEX/priv/host_loongarch64_isel.c | 25 +++++++++++++++++++++++--
 1 file changed, 23 insertions(+), 2 deletions(-)

diff --git a/VEX/priv/host_loongarch64_isel.c b/VEX/priv/host_loongarch64_isel.c
index f78fdb1fe..22fc94b4e 100644
--- a/VEX/priv/host_loongarch64_isel.c
+++ b/VEX/priv/host_loongarch64_isel.c
@@ -848,8 +848,29 @@ static HReg iselIntExpr_R_wrk ( ISelEnv* env, IRExpr* e )
 
       /* --------- LITERAL --------- */
       /* 64-bit literals */
-      case Iex_Const:
-         break;
+      case Iex_Const: {
+         ULong imm = 0;
+         HReg  dst = newVRegI(env);
+         switch (e->Iex.Const.con->tag) {
+            case Ico_U64:
+               imm = e->Iex.Const.con->Ico.U64;
+               break;
+            case Ico_U32:
+               imm = e->Iex.Const.con->Ico.U32;
+               break;
+            case Ico_U16:
+               imm = e->Iex.Const.con->Ico.U16;
+               break;
+            case Ico_U8:
+               imm = e->Iex.Const.con->Ico.U8;
+               break;
+            default:
+               ppIRExpr(e);
+               vpanic("iselIntExpr_R.Iex_Const(loongarch64)");
+         }
+         addInstr(env, LOONGARCH64Instr_LI(imm, dst));
+         return dst;
+      }
 
       default:
          break;
-- 
2.39.1

