From 0e456e1df8b708e7c5737dbcce6ff578f90629dc Mon Sep 17 00:00:00 2001
From: Feiyang Chen <chenfeiyang@loongson.cn>
Date: Tue, 22 Mar 2022 14:46:23 +0800
Subject: [PATCH v4 057/123] loongarch64: Add isel support for Iex_RdTmp of
 integer expressions

---
 VEX/priv/host_loongarch64_isel.c | 52 ++++++++++++++++++++++++++++++--
 1 file changed, 50 insertions(+), 2 deletions(-)

diff --git a/VEX/priv/host_loongarch64_isel.c b/VEX/priv/host_loongarch64_isel.c
index 9216f6967..94f00e1ef 100644
--- a/VEX/priv/host_loongarch64_isel.c
+++ b/VEX/priv/host_loongarch64_isel.c
@@ -764,8 +764,56 @@ static HReg iselIntExpr_R ( ISelEnv* env, IRExpr* e )
 /* DO NOT CALL THIS DIRECTLY ! */
 static HReg iselIntExpr_R_wrk ( ISelEnv* env, IRExpr* e )
 {
-   HReg r;
-   return r;
+   IRType ty = typeOfIRExpr(env->type_env, e);
+   vassert(e);
+   vassert(ty == Ity_I8 || ty == Ity_I16 || ty == Ity_I32 || ty == Ity_I64);
+
+   switch (e->tag) {
+      /* --------- TEMP --------- */
+      case Iex_RdTmp:
+         return lookupIRTemp(env, e->Iex.RdTmp.tmp);
+
+      /* --------- LOAD --------- */
+      case Iex_Load:
+         break;
+
+      /* --------- BINARY OP --------- */
+      case Iex_Binop: {
+         switch (e->Iex.Binop.op) {
+            default:
+               goto irreducible;
+         }
+      }
+
+      /* --------- UNARY OP --------- */
+      case Iex_Unop: {
+         switch (e->Iex.Unop.op) {
+            default:
+               goto irreducible;
+         }
+      }
+
+      /* --------- GET --------- */
+      case Iex_Get:
+         break;
+
+      /* --------- CCALL --------- */
+      case Iex_CCall:
+         break;
+
+      /* --------- LITERAL --------- */
+      /* 64-bit literals */
+      case Iex_Const:
+         break;
+
+      default:
+         break;
+   }
+
+   /* We get here if no pattern matched. */
+irreducible:
+   ppIRExpr(e);
+   vpanic("iselIntExpr_R(loongarch64): cannot reduce tree");
 }
 
 /* ------------------- CondCode ------------------- */
-- 
2.39.1

