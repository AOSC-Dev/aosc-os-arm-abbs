From 4d72befa524cef065a50becb191f3533052743a7 Mon Sep 17 00:00:00 2001
From: Feiyang Chen <chenfeiyang@loongson.cn>
Date: Tue, 22 Mar 2022 17:17:09 +0800
Subject: [PATCH v4 069/123] loongarch64: Add isel support for Iex_Load of
 floating point expressions

---
 VEX/priv/host_loongarch64_isel.c | 22 ++++++++++++++++++++--
 1 file changed, 20 insertions(+), 2 deletions(-)

diff --git a/VEX/priv/host_loongarch64_isel.c b/VEX/priv/host_loongarch64_isel.c
index e8bc86533..5cb4b99d8 100644
--- a/VEX/priv/host_loongarch64_isel.c
+++ b/VEX/priv/host_loongarch64_isel.c
@@ -1718,8 +1718,26 @@ static HReg iselFltExpr_wrk ( ISelEnv* env, IRExpr* e )
          return lookupIRTemp(env, e->Iex.RdTmp.tmp);
 
       /* --------- LOAD --------- */
-      case Iex_Load:
-         break;
+      case Iex_Load: {
+         if (e->Iex.Load.end != Iend_LE)
+            goto irreducible;
+
+         LOONGARCH64AMode* am = iselIntExpr_AMode(env, e->Iex.Load.addr, ty);
+         HReg             dst = newVRegF(env);
+         LOONGARCH64FpLoadOp op;
+         switch(ty) {
+            case Ity_F32:
+               op = (am->tag == LAam_RI) ? LAfpload_FLD_S : LAfpload_FLDX_S;
+               break;
+            case Ity_F64:
+               op = (am->tag == LAam_RI) ? LAfpload_FLD_D : LAfpload_FLDX_D;
+               break;
+            default:
+               goto irreducible;
+         }
+         addInstr(env, LOONGARCH64Instr_FpLoad(op, am, dst));
+         return dst;
+      }
 
       /* --------- GET --------- */
       case Iex_Get:
-- 
2.39.1

