From 2fd5b6bf187d69bb911b8453a5adc66af765b03d Mon Sep 17 00:00:00 2001
From: Feiyang Chen <chenfeiyang@loongson.cn>
Date: Tue, 22 Mar 2022 17:18:28 +0800
Subject: [PATCH v4 070/123] loongarch64: Add isel support for Iex_Get of
 floating point expressions

---
 VEX/priv/host_loongarch64_isel.c | 19 +++++++++++++++++--
 1 file changed, 17 insertions(+), 2 deletions(-)

diff --git a/VEX/priv/host_loongarch64_isel.c b/VEX/priv/host_loongarch64_isel.c
index 5cb4b99d8..d559fc156 100644
--- a/VEX/priv/host_loongarch64_isel.c
+++ b/VEX/priv/host_loongarch64_isel.c
@@ -1740,8 +1740,23 @@ static HReg iselFltExpr_wrk ( ISelEnv* env, IRExpr* e )
       }
 
       /* --------- GET --------- */
-      case Iex_Get:
-         break;
+      case Iex_Get: {
+         LOONGARCH64AMode* am = mkLOONGARCH64AMode_RI(hregGSP(), e->Iex.Get.offset);
+         HReg             dst = newVRegF(env);
+         LOONGARCH64FpLoadOp op;
+         switch(ty) {
+            case Ity_F32:
+               op = LAfpload_FLD_S;
+               break;
+            case Ity_F64:
+               op = LAfpload_FLD_D;
+               break;
+            default:
+               goto irreducible;
+         }
+         addInstr(env, LOONGARCH64Instr_FpLoad(op, am, dst));
+         return dst;
+      }
 
       /* --------- QUATERNARY OP --------- */
       case Iex_Qop: {
-- 
2.39.1

