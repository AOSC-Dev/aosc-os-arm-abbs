From eed1db766e49a1720af54af5a24988bd5c9fe648 Mon Sep 17 00:00:00 2001
From: Feiyang Chen <chenfeiyang@loongson.cn>
Date: Mon, 4 Jul 2022 15:57:15 +0800
Subject: [PATCH v4 119/123] loongarch64: Update massif/big-alloc test

---
 massif/tests/Makefile.am                    |  1 +
 massif/tests/big-alloc.post.exp-loongarch64 | 54 +++++++++++++++++++++
 2 files changed, 55 insertions(+)
 create mode 100644 massif/tests/big-alloc.post.exp-loongarch64

diff --git a/massif/tests/Makefile.am b/massif/tests/Makefile.am
index 5b3d1938f..e9e3ea455 100644
--- a/massif/tests/Makefile.am
+++ b/massif/tests/Makefile.am
@@ -11,6 +11,7 @@ EXTRA_DIST = \
 	big-alloc.post.exp big-alloc.post.exp-64bit big-alloc.post.exp-ppc64 \
 	big-alloc.stderr.exp big-alloc.vgtest \
 	big-alloc.post.exp-x86-freebsd \
+	big-alloc.post.exp-loongarch64 \
 	deep-A.post.exp deep-A.stderr.exp deep-A.vgtest \
 	deep-B.post.exp deep-B.stderr.exp deep-B.vgtest \
 	deep-C.post.exp deep-C.stderr.exp deep-C.vgtest \
diff --git a/massif/tests/big-alloc.post.exp-loongarch64 b/massif/tests/big-alloc.post.exp-loongarch64
new file mode 100644
index 000000000..0dd5671af
--- /dev/null
+++ b/massif/tests/big-alloc.post.exp-loongarch64
@@ -0,0 +1,54 @@
+--------------------------------------------------------------------------------
+Command:            ./big-alloc
+Massif arguments:   --stacks=no --time-unit=B --massif-out-file=massif.out --ignore-fn=__part_load_locale --ignore-fn=__time_load_locale --ignore-fn=dwarf2_unwind_dyld_add_image_hook --ignore-fn=get_or_create_key_element
+ms_print arguments: massif.out
+--------------------------------------------------------------------------------
+
+
+    MB
+100.2^                                                                       :
+     |                                                                       :
+     |                                                                @@@@@@@:
+     |                                                                @      :
+     |                                                         :::::::@      :
+     |                                                         :      @      :
+     |                                                  ::::::::      @      :
+     |                                                  :      :      @      :
+     |                                           ::::::::      :      @      :
+     |                                           :      :      :      @      :
+     |                                    ::::::::      :      :      @      :
+     |                                    :      :      :      :      @      :
+     |                            :::::::::      :      :      :      @      :
+     |                            :       :      :      :      :      @      :
+     |                     ::::::::       :      :      :      :      @      :
+     |                     :      :       :      :      :      :      @      :
+     |              ::::::::      :       :      :      :      :      @      :
+     |              :      :      :       :      :      :      :      @      :
+     |       ::::::::      :      :       :      :      :      :      @      :
+     |       :      :      :      :       :      :      :      :      @      :
+   0 +----------------------------------------------------------------------->MB
+     0                                                                   100.2
+
+Number of snapshots: 11
+ Detailed snapshots: [9]
+
+--------------------------------------------------------------------------------
+  n        time(B)         total(B)   useful-heap(B) extra-heap(B)    stacks(B)
+--------------------------------------------------------------------------------
+  0              0                0                0             0            0
+  1     10,502,088       10,502,088       10,485,760        16,328            0
+  2     21,004,176       21,004,176       20,971,520        32,656            0
+  3     31,506,264       31,506,264       31,457,280        48,984            0
+  4     42,008,352       42,008,352       41,943,040        65,312            0
+  5     52,510,440       52,510,440       52,428,800        81,640            0
+  6     63,012,528       63,012,528       62,914,560        97,968            0
+  7     73,514,616       73,514,616       73,400,320       114,296            0
+  8     84,016,704       84,016,704       83,886,080       130,624            0
+  9     94,518,792       94,518,792       94,371,840       146,952            0
+99.84% (94,371,840B) (heap allocation functions) malloc/new/new[], --alloc-fns, etc.
+->99.84% (94,371,840B) 0x........: main (big-alloc.c:12)
+  
+--------------------------------------------------------------------------------
+  n        time(B)         total(B)   useful-heap(B) extra-heap(B)    stacks(B)
+--------------------------------------------------------------------------------
+ 10    105,020,880      105,020,880      104,857,600       163,280            0
-- 
2.39.1

