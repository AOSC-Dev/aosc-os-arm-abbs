#
# Before you start:
# LibreOffice can take an hour to build on a full Xeon E1230v3 machine with 
# 16GB of RAM, not to mention that even swap is used in the final linking.
#
# For your welfare and for the sake of packaging quality, do not build this
# before you are sure...
#

# System opencollada disabled due to bug in autogen.sh (.
# System libglft disabled due to again, mysterical fail during VCL build.
# FireBird driver temporarily disabled, 5.2 will fix GCC 6 support.

# From extra-java/openjdk.

[ "${CROSS:-$ARCH}" = "amd64" ] && export JARCH="x86_64" CONFARCH="amd64"
[ "${CROSS:-$ARCH}" = "armel" ] && export JARCH="arm" CONFARCH="aarch32"
[ "${CROSS:-$ARCH}" = "arm64" ] && export JARCH="aarch64" CONFARCH="aarch64"
[ "${CROSS:-$ARCH}" = "mipsel" ] && export JARCH="mipsel" CONFARCH="mipsel"

export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:/usr/lib/java/lib/$CONFARCH"
export CFLAGS+=" -L/usr/lib/java/lib/$CONFARCH -L/usr/lib"
export LDFLAGS+=" -L/usr/lib/java/lib/$CONFARCH -L/usr/lib"

./autogen.sh \
             --with-build-version="$PKGVER" \
             --with-vendor="Anthon Open Source Community" \
             --with-parallelism="${MAKEFLAGS/-j/}" \
             --with-external-tar="$SRCDIR/ext_sources_down" \
             --disable-fetch-external \
             --disable-symbols \
             --enable-release-build \
             --prefix=/usr --exec-prefix=/usr --sysconfdir=/etc \
             --libdir=/usr/lib --mandir=/usr/share/man \
             --with-lang="" \
             --enable-crashdump \
             --enable-avahi \
             --enable-dbus \
             --enable-evolution2\
             --enable-gio\
             --disable-kde4 \
             --enable-gtk \
             --disable-gtk3 \
             --disable-gstreamer-0-10 \
             --enable-openssl \
             --enable-odk\
             --enable-orcus \
             --enable-python=system \
             --enable-scripting-beanshell \
             --enable-scripting-javascript \
             --disable-telepathy \
             --enable-ext-wiki-publisher \
             --enable-ext-nlpsolver \
             --without-fonts\
             --with-system-apr \
             --with-system-libcdr \
             --with-system-mdds\
             --without-myspell-dicts \
             --with-system-libvisio \
             --with-system-libcmis \
             --with-system-libmspub \
             --with-system-libexttextcat \
             --with-system-orcus \
             --with-system-liblangtag \
             --without-system-jfreereport \
             --with-system-apache-commons \
             --with-system-libodfgen \
             --with-system-libmwaw \
             --with-system-libetonyek \
             --with-system-libfreehand \
             --disable-firebird-sdbc \
             --with-system-libatomic-ops \
             --with-system-libebook \
             --with-system-libabw \
             --with-system-coinmp \
             --without-system-libgltf \
             --without-system-opencollada \
             --with-system-dicts \
             --with-external-dict-dir=/usr/share/hunspell \
             --with-external-hyph-dir=/usr/share/hyphen \
             --with-external-thes-dir=/usr/share/mythes \
             --with-system-beanshell \
             --with-system-cppunit\
             --with-system-graphite\
             --with-system-glew \
             --with-system-glm \
             --with-system-libwpg \
             --with-system-libwps \
             --with-system-redland\
             --with-system-ucpp \
             --with-system-serf \
             --with-system-libpagemaker \
             --with-jdk-home="/usr/lib/java" \
             --with-ant-home="/usr/share/apache-ant"\
             --without-system-boost\
             --with-system-icu \
             --with-system-cairo \
             --with-system-libs \
             --with-system-mythes \
             --with-system-headers \
             --without-system-hsqldb \
             --with-sac-jar=/usr/share/java/sacjava/sac.jar \
             --with-alloc=system \
             --with-system-clucene \
             --without-system-jpeg \
             --with-jpeg-turbo \
             --disable-dependency-tracking \
             --enable-hardlink-deliver \
             --without-junit

touch src.downloaded

make build-nocheck
make distro-pack-install DESTDIR="$PKGDIR"
