From c62a0439ca3a64fa6f906a45cdcadb50ed5e2fb2 Mon Sep 17 00:00:00 2001
From: liushuyu <liushuyu011@gmail.com>
Date: Mon, 6 Dec 2021 01:34:11 -0700
Subject: [PATCH] Fix patches on LLVM 13

---
 ...uncParamKindINTEL-and-DecorationFuncP.patch | 18 +++++++++---------
 .../0002-Add-SPIRVDLL-and-VCExport.patch       | 16 ++++++++--------
 ...VLib-from-targets-Rename-tool-llvm-sp.patch |  8 ++++----
 .../0004-Simplify-VCExport-opts.patch          |  4 ++--
 .../0005-Fix-missing-extensions-enabling.patch |  4 ++--
 ...zation-constant-support-to-VC-backend.patch |  6 +++---
 6 files changed, 28 insertions(+), 28 deletions(-)

diff --git a/IGC/VectorCompiler/spirv-patches-13/0001-Add-DecorationFuncParamKindINTEL-and-DecorationFuncP.patch b/IGC/VectorCompiler/spirv-patches-13/0001-Add-DecorationFuncParamKindINTEL-and-DecorationFuncP.patch
index d98782109..b3c21b840 100644
--- a/IGC/VectorCompiler/spirv-patches-13/0001-Add-DecorationFuncParamKindINTEL-and-DecorationFuncP.patch
+++ b/IGC/VectorCompiler/spirv-patches-13/0001-Add-DecorationFuncParamKindINTEL-and-DecorationFuncP.patch
@@ -1,4 +1,4 @@
-From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
+From 239a560aa49e1d0e753f81f182965cb822b41fa4 Mon Sep 17 00:00:00 2001
 From: nrudenko <nikita.rudenko@intel.com>
 Date: Thu, 4 Jun 2020 16:34:15 +0300
 Subject: [PATCH 1/6] Add DecorationFuncParamKindINTEL and
@@ -16,7 +16,7 @@ Subject: [PATCH 1/6] Add DecorationFuncParamKindINTEL and
  8 files changed, 59 insertions(+), 1 deletion(-)
 
 diff --git a/lib/SPIRV/SPIRVReader.cpp b/lib/SPIRV/SPIRVReader.cpp
-index 00000000..00000000 100644
+index 7696990c..b351691c 100644
 --- a/lib/SPIRV/SPIRVReader.cpp
 +++ b/lib/SPIRV/SPIRVReader.cpp
 @@ -3899,6 +3899,18 @@ bool SPIRVToLLVM::transVectorComputeMetadata(SPIRVFunction *BF) {
@@ -39,7 +39,7 @@ index 00000000..00000000 100644
  
    // Do not add float control if there is no any
 diff --git a/lib/SPIRV/SPIRVWriter.cpp b/lib/SPIRV/SPIRVWriter.cpp
-index 00000000..00000000 100644
+index ad41677b..e67da7bd 100644
 --- a/lib/SPIRV/SPIRVWriter.cpp
 +++ b/lib/SPIRV/SPIRVWriter.cpp
 @@ -749,6 +749,19 @@ void LLVMToSPIRVBase::transVectorComputeMetadata(Function *F) {
@@ -63,7 +63,7 @@ index 00000000..00000000 100644
    if (!isKernel(F) &&
        BM->isAllowedToUseExtension(ExtensionID::SPV_INTEL_float_controls2) &&
 diff --git a/lib/SPIRV/VectorComputeUtil.h b/lib/SPIRV/VectorComputeUtil.h
-index 00000000..00000000 100755
+index a95c67ab..9b91481b 100755
 --- a/lib/SPIRV/VectorComputeUtil.h
 +++ b/lib/SPIRV/VectorComputeUtil.h
 @@ -111,6 +111,8 @@ const static char VCSIMTCall[] = "VCSIMTCall";
@@ -76,7 +76,7 @@ index 00000000..00000000 100755
  
  namespace kVCType {
 diff --git a/lib/SPIRV/libSPIRV/SPIRVDecorate.cpp b/lib/SPIRV/libSPIRV/SPIRVDecorate.cpp
-index 00000000..00000000 100644
+index 4da518a0..3767b9bc 100644
 --- a/lib/SPIRV/libSPIRV/SPIRVDecorate.cpp
 +++ b/lib/SPIRV/libSPIRV/SPIRVDecorate.cpp
 @@ -114,6 +114,9 @@ void SPIRVDecorate::encode(spv_ostream &O) const {
@@ -120,7 +120,7 @@ index 00000000..00000000 100644
      Decoder >> Literals;
    }
 diff --git a/lib/SPIRV/libSPIRV/SPIRVDecorate.h b/lib/SPIRV/libSPIRV/SPIRVDecorate.h
-index 00000000..00000000 100644
+index 91e73910..0c131ac9 100644
 --- a/lib/SPIRV/libSPIRV/SPIRVDecorate.h
 +++ b/lib/SPIRV/libSPIRV/SPIRVDecorate.h
 @@ -499,6 +499,15 @@ public:
@@ -140,7 +140,7 @@ index 00000000..00000000 100644
  public:
    // Complete constructor for MergeINTEL decoration
 diff --git a/lib/SPIRV/libSPIRV/SPIRVEnum.h b/lib/SPIRV/libSPIRV/SPIRVEnum.h
-index 00000000..00000000 100644
+index 45b935fe..48fa3edc 100644
 --- a/lib/SPIRV/libSPIRV/SPIRVEnum.h
 +++ b/lib/SPIRV/libSPIRV/SPIRVEnum.h
 @@ -440,6 +440,8 @@ template <> inline void SPIRVMap<Decoration, SPIRVCapVec>::init() {
@@ -153,7 +153,7 @@ index 00000000..00000000 100644
  
  template <> inline void SPIRVMap<BuiltIn, SPIRVCapVec>::init() {
 diff --git a/lib/SPIRV/libSPIRV/SPIRVNameMapEnum.h b/lib/SPIRV/libSPIRV/SPIRVNameMapEnum.h
-index 00000000..00000000 100644
+index 5d17e581..f5062d89 100644
 --- a/lib/SPIRV/libSPIRV/SPIRVNameMapEnum.h
 +++ b/lib/SPIRV/libSPIRV/SPIRVNameMapEnum.h
 @@ -179,6 +179,8 @@ template <> inline void SPIRVMap<Decoration, std::string>::init() {
@@ -166,7 +166,7 @@ index 00000000..00000000 100644
    add(DecorationMax, "Max");
  }
 diff --git a/lib/SPIRV/libSPIRV/spirv_internal.hpp b/lib/SPIRV/libSPIRV/spirv_internal.hpp
-index 00000000..00000000 100644
+index f0e311c6..cbf7021a 100644
 --- a/lib/SPIRV/libSPIRV/spirv_internal.hpp
 +++ b/lib/SPIRV/libSPIRV/spirv_internal.hpp
 @@ -54,7 +54,9 @@ enum InternalDecoration {
diff --git a/IGC/VectorCompiler/spirv-patches-13/0002-Add-SPIRVDLL-and-VCExport.patch b/IGC/VectorCompiler/spirv-patches-13/0002-Add-SPIRVDLL-and-VCExport.patch
index 6b073b1be..5f3d353b6 100644
--- a/IGC/VectorCompiler/spirv-patches-13/0002-Add-SPIRVDLL-and-VCExport.patch
+++ b/IGC/VectorCompiler/spirv-patches-13/0002-Add-SPIRVDLL-and-VCExport.patch
@@ -1,4 +1,4 @@
-From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
+From e41330f630c54ae692da25e0a43246a6badc1d49 Mon Sep 17 00:00:00 2001
 From: nrudenko <nikita.rudenko@intel.com>
 Date: Thu, 4 Jun 2020 15:20:43 +0300
 Subject: [PATCH 2/6] Add SPIRVDLL and VCExport
@@ -9,13 +9,13 @@ Subject: [PATCH 2/6] Add SPIRVDLL and VCExport
  lib/SPIRV/VCExport.h     | 28 +++++++++++++
  3 files changed, 157 insertions(+), 1 deletion(-)
  mode change 100644 => 100755 lib/SPIRV/CMakeLists.txt
- create mode 100755 lib/SPIRV/VCExport.cpp
- create mode 100755 lib/SPIRV/VCExport.h
+ create mode 100644 lib/SPIRV/VCExport.cpp
+ create mode 100644 lib/SPIRV/VCExport.h
 
 diff --git a/lib/SPIRV/CMakeLists.txt b/lib/SPIRV/CMakeLists.txt
 old mode 100644
 new mode 100755
-index 00000000..00000000
+index 1d0b7f3e..001c2bf9
 --- a/lib/SPIRV/CMakeLists.txt
 +++ b/lib/SPIRV/CMakeLists.txt
 @@ -1,5 +1,6 @@
@@ -83,8 +83,8 @@ index 00000000..00000000
 +    ${CMAKE_CURRENT_SOURCE_DIR}/Mangler
 +)
 diff --git a/lib/SPIRV/VCExport.cpp b/lib/SPIRV/VCExport.cpp
-new file mode 100755
-index 00000000..00000000
+new file mode 100644
+index 00000000..e8893e19
 --- /dev/null
 +++ b/lib/SPIRV/VCExport.cpp
 @@ -0,0 +1,89 @@
@@ -178,8 +178,8 @@ index 00000000..00000000
 +  return 0;
 +}
 diff --git a/lib/SPIRV/VCExport.h b/lib/SPIRV/VCExport.h
-new file mode 100755
-index 00000000..00000000
+new file mode 100644
+index 00000000..3b989ed8
 --- /dev/null
 +++ b/lib/SPIRV/VCExport.h
 @@ -0,0 +1,28 @@
diff --git a/IGC/VectorCompiler/spirv-patches-13/0003-Remove-LLVMSPIRVLib-from-targets-Rename-tool-llvm-sp.patch b/IGC/VectorCompiler/spirv-patches-13/0003-Remove-LLVMSPIRVLib-from-targets-Rename-tool-llvm-sp.patch
index 8adab8b08..72cc33396 100644
--- a/IGC/VectorCompiler/spirv-patches-13/0003-Remove-LLVMSPIRVLib-from-targets-Rename-tool-llvm-sp.patch
+++ b/IGC/VectorCompiler/spirv-patches-13/0003-Remove-LLVMSPIRVLib-from-targets-Rename-tool-llvm-sp.patch
@@ -1,4 +1,4 @@
-From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
+From 003cc1278e6ce0781159743f43ad00b61557b921 Mon Sep 17 00:00:00 2001
 From: nrudenko <nikita.rudenko@intel.com>
 Date: Thu, 11 Jun 2020 15:58:34 +0300
 Subject: [PATCH 3/6] Remove LLVMSPIRVLib from targets Rename tool llvm-spirv
@@ -11,7 +11,7 @@ Subject: [PATCH 3/6] Remove LLVMSPIRVLib from targets Rename tool llvm-spirv
  3 files changed, 3 insertions(+), 42 deletions(-)
 
 diff --git a/lib/SPIRV/CMakeLists.txt b/lib/SPIRV/CMakeLists.txt
-index 00000000..00000000 100755
+index 001c2bf9..a5f86b73 100755
 --- a/lib/SPIRV/CMakeLists.txt
 +++ b/lib/SPIRV/CMakeLists.txt
 @@ -39,20 +39,6 @@ set(SPIRV_SOURCES
@@ -58,7 +58,7 @@ index 00000000..00000000 100755
 -    ${CMAKE_CURRENT_SOURCE_DIR}/Mangler
 -)
 diff --git a/test/CMakeLists.txt b/test/CMakeLists.txt
-index 00000000..00000000 100644
+index 4813100f..3b58514a 100644
 --- a/test/CMakeLists.txt
 +++ b/test/CMakeLists.txt
 @@ -76,14 +76,6 @@ if(NOT LLVM_SPIRV_BUILD_EXTERNAL)
@@ -87,7 +87,7 @@ index 00000000..00000000 100644
    cmake_policy(POP)
  endif(LLVM_SPIRV_BUILD_EXTERNAL)
 diff --git a/tools/llvm-spirv/CMakeLists.txt b/tools/llvm-spirv/CMakeLists.txt
-index 00000000..00000000 100644
+index 501c0daf..3130b92c 100644
 --- a/tools/llvm-spirv/CMakeLists.txt
 +++ b/tools/llvm-spirv/CMakeLists.txt
 @@ -8,17 +8,13 @@ set(LLVM_LINK_COMPONENTS
diff --git a/IGC/VectorCompiler/spirv-patches-13/0004-Simplify-VCExport-opts.patch b/IGC/VectorCompiler/spirv-patches-13/0004-Simplify-VCExport-opts.patch
index b97fa267e..7390d96eb 100644
--- a/IGC/VectorCompiler/spirv-patches-13/0004-Simplify-VCExport-opts.patch
+++ b/IGC/VectorCompiler/spirv-patches-13/0004-Simplify-VCExport-opts.patch
@@ -1,4 +1,4 @@
-From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
+From 00ba622cd3ec066dafb2ca54fc1e9950b487a1b1 Mon Sep 17 00:00:00 2001
 From: nrudenko <nikita.rudenko@intel.com>
 Date: Wed, 9 Sep 2020 16:24:41 +0300
 Subject: [PATCH 4/6] Simplify VCExport opts
@@ -8,7 +8,7 @@ Subject: [PATCH 4/6] Simplify VCExport opts
  1 file changed, 1 insertion(+), 18 deletions(-)
 
 diff --git a/lib/SPIRV/VCExport.cpp b/lib/SPIRV/VCExport.cpp
-index 00000000..00000000 100755
+index e8893e19..c67590df 100644
 --- a/lib/SPIRV/VCExport.cpp
 +++ b/lib/SPIRV/VCExport.cpp
 @@ -23,24 +23,7 @@
diff --git a/IGC/VectorCompiler/spirv-patches-13/0005-Fix-missing-extensions-enabling.patch b/IGC/VectorCompiler/spirv-patches-13/0005-Fix-missing-extensions-enabling.patch
index e871a1007..7c4c9cc63 100644
--- a/IGC/VectorCompiler/spirv-patches-13/0005-Fix-missing-extensions-enabling.patch
+++ b/IGC/VectorCompiler/spirv-patches-13/0005-Fix-missing-extensions-enabling.patch
@@ -1,4 +1,4 @@
-From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
+From 49fc6eaf62b81c6c27947f939f3f869864e7f220 Mon Sep 17 00:00:00 2001
 From: nrudenko <nikita.rudenko@intel.com>
 Date: Fri, 11 Sep 2020 15:57:55 +0300
 Subject: [PATCH 5/6] Fix missing extensions enabling
@@ -8,7 +8,7 @@ Subject: [PATCH 5/6] Fix missing extensions enabling
  1 file changed, 1 insertion(+)
 
 diff --git a/lib/SPIRV/VCExport.cpp b/lib/SPIRV/VCExport.cpp
-index 00000000..00000000 100755
+index c67590df..b3715c51 100644
 --- a/lib/SPIRV/VCExport.cpp
 +++ b/lib/SPIRV/VCExport.cpp
 @@ -24,6 +24,7 @@
diff --git a/IGC/VectorCompiler/spirv-patches-13/0006-Add-specialization-constant-support-to-VC-backend.patch b/IGC/VectorCompiler/spirv-patches-13/0006-Add-specialization-constant-support-to-VC-backend.patch
index 252947bd6..da8e5f7f3 100644
--- a/IGC/VectorCompiler/spirv-patches-13/0006-Add-specialization-constant-support-to-VC-backend.patch
+++ b/IGC/VectorCompiler/spirv-patches-13/0006-Add-specialization-constant-support-to-VC-backend.patch
@@ -1,4 +1,4 @@
-From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
+From b599e1f53875f5c9c91feab3313579914ab18eba Mon Sep 17 00:00:00 2001
 From: "Sidorenko, Anton" <anton.sidorenko@intel.com>
 Date: Fri, 11 Sep 2020 12:44:25 +0300
 Subject: [PATCH 6/6] Add specialization constant support to VC backend
@@ -9,7 +9,7 @@ Subject: [PATCH 6/6] Add specialization constant support to VC backend
  2 files changed, 15 insertions(+), 4 deletions(-)
 
 diff --git a/lib/SPIRV/VCExport.cpp b/lib/SPIRV/VCExport.cpp
-index 00000000..00000000 100755
+index b3715c51..9be338f3 100644
 --- a/lib/SPIRV/VCExport.cpp
 +++ b/lib/SPIRV/VCExport.cpp
 @@ -22,16 +22,25 @@
@@ -51,7 +51,7 @@ index 00000000..00000000 100755
      bool Status = llvm::readSpirv(Context, Opts, IS, SpirM, ErrMsg);
      if (!Status) {
 diff --git a/lib/SPIRV/VCExport.h b/lib/SPIRV/VCExport.h
-index 00000000..00000000 100755
+index 3b989ed8..a83a656b 100644
 --- a/lib/SPIRV/VCExport.h
 +++ b/lib/SPIRV/VCExport.h
 @@ -20,7 +20,8 @@
-- 
2.34.1

