From 3c492449e6809180fbe72cc52826f06d2a9bdbeb Mon Sep 17 00:00:00 2001
From: liushuyu <liushuyu011@gmail.com>
Date: Thu, 3 Oct 2019 21:16:18 -0600
Subject: [PATCH 1/3] zxtune-qt: Port to Qt 5

---
 apps/zxtune-qt/Makefile                       |  6 ++--
 apps/zxtune-qt/playlist/io/export_xspf.cpp    |  4 +--
 apps/zxtune-qt/playlist/supp/controller.cpp   |  2 +-
 apps/zxtune-qt/playlist/supp/model.cpp        | 17 +++++++---
 apps/zxtune-qt/playlist/supp/session.cpp      |  7 +++--
 apps/zxtune-qt/playlist/ui/container_view.cpp |  4 +--
 apps/zxtune-qt/playlist/ui/container_view.h   |  2 +-
 .../ui/desktop/playlist_contextmenu.cpp       |  8 ++---
 .../playlist/ui/desktop/properties_dialog.cpp | 12 +++----
 .../playlist/ui/desktop/properties_dialog.h   |  2 +-
 .../playlist/ui/desktop/search_dialog.h       |  2 +-
 apps/zxtune-qt/playlist/ui/playlist_view.cpp  | 31 ++++++++++---------
 apps/zxtune-qt/playlist/ui/playlist_view.h    |  2 +-
 apps/zxtune-qt/playlist/ui/scanner_view.cpp   |  2 +-
 apps/zxtune-qt/playlist/ui/scanner_view.h     |  2 +-
 apps/zxtune-qt/playlist/ui/table_view.cpp     | 13 ++++----
 apps/zxtune-qt/playlist/ui/table_view.h       |  4 +--
 apps/zxtune-qt/qt_app.cpp                     |  2 +-
 apps/zxtune-qt/singlemode.cpp                 |  1 +
 .../ui/controls/analyzer_control.cpp          |  2 +-
 apps/zxtune-qt/ui/controls/analyzer_control.h |  2 +-
 .../ui/controls/overlay_progress.cpp          |  6 ++--
 apps/zxtune-qt/ui/controls/overlay_progress.h |  2 +-
 .../ui/controls/playback_controls.cpp         |  2 +-
 .../zxtune-qt/ui/controls/playback_controls.h |  2 +-
 apps/zxtune-qt/ui/controls/playback_options.h |  2 +-
 apps/zxtune-qt/ui/controls/seek_controls.cpp  |  4 +--
 apps/zxtune-qt/ui/controls/seek_controls.h    |  2 +-
 apps/zxtune-qt/ui/controls/status_control.cpp |  4 +--
 apps/zxtune-qt/ui/controls/status_control.h   |  2 +-
 apps/zxtune-qt/ui/controls/volume_control.h   |  2 +-
 .../ui/conversion/backend_settings.h          |  2 +-
 .../ui/conversion/filename_template.cpp       | 10 +++---
 .../ui/conversion/filename_template.h         |  2 +-
 .../zxtune-qt/ui/conversion/flac_settings.cpp |  2 +-
 apps/zxtune-qt/ui/conversion/mp3_settings.cpp |  2 +-
 apps/zxtune-qt/ui/conversion/ogg_settings.cpp |  2 +-
 .../ui/conversion/setup_conversion.cpp        |  6 ++--
 .../ui/conversion/setup_conversion.h          |  2 +-
 .../ui/conversion/supported_formats.cpp       |  2 +-
 .../ui/conversion/supported_formats.h         |  2 +-
 apps/zxtune-qt/ui/desktop/mainwindow.cpp      | 10 +++---
 .../ui/informational/aboutdialog.cpp          |  6 ++--
 .../ui/informational/componentsdialog.cpp     |  6 ++--
 apps/zxtune-qt/ui/mainwindow.h                |  2 +-
 apps/zxtune-qt/ui/preferences/aym.h           |  2 +-
 apps/zxtune-qt/ui/preferences/interface.cpp   |  2 +-
 apps/zxtune-qt/ui/preferences/interface.h     |  2 +-
 apps/zxtune-qt/ui/preferences/mixer.h         |  2 +-
 apps/zxtune-qt/ui/preferences/mixing.cpp      |  2 +-
 apps/zxtune-qt/ui/preferences/mixing.h        |  2 +-
 apps/zxtune-qt/ui/preferences/plugins.h       |  2 +-
 .../ui/preferences/preferencesdialog.cpp      |  8 ++---
 .../ui/preferences/preferencesdialog.h        |  2 +-
 apps/zxtune-qt/ui/preferences/saa.h           |  2 +-
 apps/zxtune-qt/ui/preferences/sid.h           |  2 +-
 apps/zxtune-qt/ui/preferences/sound.h         |  2 +-
 apps/zxtune-qt/ui/preferences/sound_alsa.cpp  |  2 +-
 apps/zxtune-qt/ui/preferences/sound_oss.cpp   |  2 +-
 apps/zxtune-qt/ui/preferences/z80.h           |  2 +-
 apps/zxtune-qt/ui/state.cpp                   | 14 ++++-----
 apps/zxtune-qt/ui/styles.cpp                  |  4 +--
 apps/zxtune-qt/ui/tools/errordialog.cpp       |  2 +-
 apps/zxtune-qt/ui/tools/errorswidget.cpp      |  4 +--
 apps/zxtune-qt/ui/tools/errorswidget.h        |  2 +-
 apps/zxtune-qt/ui/tools/filedialog.cpp        |  2 +-
 .../zxtune-qt/ui/tools/parameters_helpers.cpp | 14 ++++-----
 apps/zxtune-qt/ui/utils.h                     |  1 +
 apps/zxtune-qt/update/check.cpp               |  8 ++---
 apps/zxtune-qt/update/check.h                 |  2 +-
 make/qt.mak                                   |  2 +-
 71 files changed, 158 insertions(+), 144 deletions(-)

diff --git a/apps/zxtune-qt/Makefile b/apps/zxtune-qt/Makefile
index 36fd6c41c..3c322d978 100644
--- a/apps/zxtune-qt/Makefile
+++ b/apps/zxtune-qt/Makefile
@@ -9,8 +9,8 @@ source_files.windows = res/zxtune-qt.rc
 source_files.mingw = $(source_files.windows)
 
 #ui-related
-#gui_theme ?= default
-gui_theme ?= restorer
+gui_theme ?= default
+#gui_theme ?= restorer
 have_gui = 1
 
 #other
@@ -38,7 +38,7 @@ depends += $(addprefix apps/zxtune-qt/,playlist/supp playlist/ui playlist/io ui)
 
 libraries.boost = filesystem system
 
-libraries.qt = Gui Core Network
+libraries.qt = Gui Core Network Widgets
 
 libraries.common += l10n debug
 libraries += ui_desktop playlist_ui_desktop ui_conversion ui_preferences check_update
diff --git a/apps/zxtune-qt/playlist/io/export_xspf.cpp b/apps/zxtune-qt/playlist/io/export_xspf.cpp
index 728c72716..929eba768 100644
--- a/apps/zxtune-qt/playlist/io/export_xspf.cpp
+++ b/apps/zxtune-qt/playlist/io/export_xspf.cpp
@@ -46,7 +46,7 @@ namespace
 
   QString DataToQString(const QByteArray& data)
   {
-    return QString::fromAscii(data.data(), data.size());
+    return QString::fromLatin1(data.data(), data.size());
   }
 
   QString ConvertString(const String& str)
@@ -233,7 +233,7 @@ namespace
     {
       Dbg(" Save content");
       Element.Text(ENDL);
-      Element.CData(QString::fromAscii(static_cast<const char*>(content.Start()), content.Size()));
+      Element.CData(QString::fromLatin1(static_cast<const char*>(content.Start()), content.Size()));
       Element.Text(ENDL);
     }
   private:
diff --git a/apps/zxtune-qt/playlist/supp/controller.cpp b/apps/zxtune-qt/playlist/supp/controller.cpp
index 1f66c5a3f..409f37def 100644
--- a/apps/zxtune-qt/playlist/supp/controller.cpp
+++ b/apps/zxtune-qt/playlist/supp/controller.cpp
@@ -20,7 +20,7 @@
 //library includes
 #include <debug/log.h>
 //qt includes
-#include <QtGui/QMessageBox>
+#include <QMessageBox>
 
 namespace
 {
diff --git a/apps/zxtune-qt/playlist/supp/model.cpp b/apps/zxtune-qt/playlist/supp/model.cpp
index bac5a3090..1ad9061f0 100644
--- a/apps/zxtune-qt/playlist/supp/model.cpp
+++ b/apps/zxtune-qt/playlist/supp/model.cpp
@@ -25,6 +25,7 @@
 #include <mutex>
 //qt includes
 #include <QtCore/QMimeData>
+#include <QtCore/QDataStream>
 #include <QtCore/QSet>
 #include <QtCore/QStringList>
 //text includes
@@ -269,7 +270,7 @@ namespace
     QStringList Paths;
   };
   
-  //https://en.wikipedia.org/wiki/Readers–writer_lock
+  //https://en.wikipedia.org/wiki/Readersï¿½writer_lock
   template<class MutexType>
   class RWMutexType
   {
@@ -405,7 +406,10 @@ namespace
         Container = Playlist::Item::Storage::Create();
         remapping = GetIndicesChanges();
       }
+      beginResetModel();
       NotifyAboutIndexChanged(remapping);
+      FetchedItemsCount = 0;
+      endResetModel();
     }
 
     void RemoveItems(IndexSet::Ptr items) override
@@ -414,12 +418,17 @@ namespace
       {
         return;
       }
+      size_t ItemsCount = items->size();
+      size_t NewItemsCount = FetchedItemsCount - ItemsCount;
       Playlist::Model::OldToNewIndexMap::Ptr remapping;
       {
         const RWMutex::WriteLock lock(SyncAccess);
         Container->RemoveItems(*items);
         remapping = GetIndicesChanges();
       }
+      beginRemoveRows(EMPTY_INDEX, NewItemsCount, FetchedItemsCount);
+      FetchedItemsCount = NewItemsCount;
+      endRemoveRows();
       NotifyAboutIndexChanged(remapping);
     }
 
@@ -549,8 +558,9 @@ namespace
       return FetchedItemsCount < Container->CountItems();
     }
 
-    void fetchMore(const QModelIndex& /*index*/) override
+    void fetchMore(const QModelIndex& parent) override
     {
+      if (parent.isValid()) return;
       const RWMutex::ReadLock lock(SyncAccess);
       const std::size_t nextCount = Container->CountItems();
       beginInsertRows(EMPTY_INDEX, static_cast<int>(FetchedItemsCount), nextCount - 1);
@@ -671,7 +681,6 @@ namespace
 
     Playlist::Model::OldToNewIndexMap::Ptr GetIndicesChanges()
     {
-      FetchedItemsCount = Container->CountItems();
       return Container->ResetIndices();
     }
 
@@ -680,7 +689,7 @@ namespace
       if (changes)
       {
         emit IndicesChanged(changes);
-        reset();
+        revert();
       }
     }
 
diff --git a/apps/zxtune-qt/playlist/supp/session.cpp b/apps/zxtune-qt/playlist/supp/session.cpp
index f5c1accb4..687472730 100644
--- a/apps/zxtune-qt/playlist/supp/session.cpp
+++ b/apps/zxtune-qt/playlist/supp/session.cpp
@@ -23,7 +23,8 @@
 //qt includes
 #include <QtCore/QDir>
 #include <QtCore/QStringList>
-#include <QtGui/QDesktopServices>
+#include <QtCore/QStandardPaths>
+//#include <QDesktopServices>
 //text includes
 #include "text/text.h"
 
@@ -61,14 +62,14 @@ namespace
   template<class T>
   QString BuildPlaylistFileName(const T& val)
   {
-    return QString::fromAscii("%1.xspf").arg(val);
+    return QString::fromLatin1("%1.xspf").arg(val);
   }
 
   class FiledSession : public Playlist::Session
   {
   public:
     FiledSession()
-      : Directory(QDesktopServices::storageLocation(QDesktopServices::DataLocation))
+      : Directory(QStandardPaths::locate(QStandardPaths::DataLocation, "", QStandardPaths::LocateDirectory))
     {
       const QLatin1String dirPath(Text::PLAYLISTS_DIR);
       Require(Directory.mkpath(dirPath));
diff --git a/apps/zxtune-qt/playlist/ui/container_view.cpp b/apps/zxtune-qt/playlist/ui/container_view.cpp
index 0b7b6d04e..16dc22474 100644
--- a/apps/zxtune-qt/playlist/ui/container_view.cpp
+++ b/apps/zxtune-qt/playlist/ui/container_view.cpp
@@ -33,8 +33,8 @@
 #include <QtCore/QCoreApplication>
 #include <QtCore/QDir>
 #include <QtCore/QTimer>
-#include <QtGui/QContextMenuEvent>
-#include <QtGui/QMenu>
+#include <QContextMenuEvent>
+#include <QMenu>
 
 namespace
 {
diff --git a/apps/zxtune-qt/playlist/ui/container_view.h b/apps/zxtune-qt/playlist/ui/container_view.h
index 37a2e7733..94272340d 100644
--- a/apps/zxtune-qt/playlist/ui/container_view.h
+++ b/apps/zxtune-qt/playlist/ui/container_view.h
@@ -16,7 +16,7 @@
 //library includes
 #include <parameters/container.h>
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 class QMenu;
 class QStringList;
diff --git a/apps/zxtune-qt/playlist/ui/desktop/playlist_contextmenu.cpp b/apps/zxtune-qt/playlist/ui/desktop/playlist_contextmenu.cpp
index 544f3d4a8..cf12d01e2 100644
--- a/apps/zxtune-qt/playlist/ui/desktop/playlist_contextmenu.cpp
+++ b/apps/zxtune-qt/playlist/ui/desktop/playlist_contextmenu.cpp
@@ -32,9 +32,9 @@
 //library includes
 #include <time/serialize.h>
 //qt includes
-#include <QtGui/QApplication>
-#include <QtGui/QClipboard>
-#include <QtGui/QMenu>
+#include <QApplication>
+#include <QClipboard>
+#include <QMenu>
 
 namespace
 {
@@ -185,7 +185,7 @@ namespace
       QStringList result;
       for (const auto& type : Types)
       {
-        result.append(QString::fromAscii("%1: %2")
+        result.append(QString::fromLatin1("%1: %2")
           .arg(ToQString(type.first)).arg(ModulesCount(type.second)));
       }
       return result.join(LINE_BREAK);
diff --git a/apps/zxtune-qt/playlist/ui/desktop/properties_dialog.cpp b/apps/zxtune-qt/playlist/ui/desktop/properties_dialog.cpp
index 6f5a5c63c..394d6cdec 100644
--- a/apps/zxtune-qt/playlist/ui/desktop/properties_dialog.cpp
+++ b/apps/zxtune-qt/playlist/ui/desktop/properties_dialog.cpp
@@ -26,12 +26,12 @@
 #include <parameters/merged_accessor.h>
 #include <sound/sound_parameters.h>
 //qt includes
-#include <QtGui/QAbstractButton>
-#include <QtGui/QComboBox>
-#include <QtGui/QLabel>
-#include <QtGui/QLineEdit>
-#include <QtGui/QTextBrowser>
-#include <QtGui/QToolButton>
+#include <QAbstractButton>
+#include <QComboBox>
+#include <QLabel>
+#include <QLineEdit>
+#include <QTextBrowser>
+#include <QToolButton>
 
 namespace
 {
diff --git a/apps/zxtune-qt/playlist/ui/desktop/properties_dialog.h b/apps/zxtune-qt/playlist/ui/desktop/properties_dialog.h
index 95ef9775d..d5ec87859 100644
--- a/apps/zxtune-qt/playlist/ui/desktop/properties_dialog.h
+++ b/apps/zxtune-qt/playlist/ui/desktop/properties_dialog.h
@@ -14,7 +14,7 @@
 #include "playlist/supp/model.h"
 #include "playlist/supp/operations_search.h"
 //qt includes
-#include <QtGui/QDialog>
+#include <QDialog>
 
 class QAbstractButton;
 namespace Playlist
diff --git a/apps/zxtune-qt/playlist/ui/desktop/search_dialog.h b/apps/zxtune-qt/playlist/ui/desktop/search_dialog.h
index 893da97f0..5868dab81 100644
--- a/apps/zxtune-qt/playlist/ui/desktop/search_dialog.h
+++ b/apps/zxtune-qt/playlist/ui/desktop/search_dialog.h
@@ -15,7 +15,7 @@
 #include "playlist/supp/model.h"
 #include "playlist/supp/operations_search.h"
 //qt includes
-#include <QtGui/QDialog>
+#include <QDialog>
 
 namespace Playlist
 {
diff --git a/apps/zxtune-qt/playlist/ui/playlist_view.cpp b/apps/zxtune-qt/playlist/ui/playlist_view.cpp
index b7c7d9ef0..17c98ca32 100644
--- a/apps/zxtune-qt/playlist/ui/playlist_view.cpp
+++ b/apps/zxtune-qt/playlist/ui/playlist_view.cpp
@@ -39,15 +39,16 @@
 #include <boost/algorithm/string/replace.hpp>
 //qt includes
 #include <QtCore/QUrl>
-#include <QtGui/QApplication>
-#include <QtGui/QClipboard>
-#include <QtGui/QDragEnterEvent>
-#include <QtGui/QHeaderView>
-#include <QtGui/QInputDialog>
-#include <QtGui/QKeyEvent>
-#include <QtGui/QProgressBar>
-#include <QtGui/QProxyModel>
-#include <QtGui/QVBoxLayout>
+#include <QtCore/QMimeData>
+#include <QtCore/QIdentityProxyModel>
+#include <QApplication>
+#include <QClipboard>
+#include <QDragEnterEvent>
+#include <QHeaderView>
+#include <QInputDialog>
+#include <QKeyEvent>
+#include <QProgressBar>
+#include <QVBoxLayout>
 
 namespace
 {
@@ -65,7 +66,7 @@ namespace
     Playlist::Item::State GetState(const QModelIndex& index) const override
     {
       assert(index.isValid());
-      if (index.internalId() == Model.GetVersion())
+      // if (index.internalId() == Model.GetVersion())
       {
         const Playlist::Model::IndexType row = index.row();
         if (row == Iterator.GetIndex())
@@ -192,14 +193,14 @@ namespace
     mutable Strings::Template::Ptr TemplateData;
   };
 
-  class RetranslateModel : public QProxyModel
+  class RetranslateModel : public QIdentityProxyModel
   {
   public:
     explicit RetranslateModel(Playlist::Model& model)
-      : QProxyModel(&model)
+      : QIdentityProxyModel(&model)
       , Delegate(model)
     {
-      setModel(&model);
+      setSourceModel(&model);
       Dbg("Created retranslation model at %1% for %2%", this, &model);
     }
 
@@ -215,7 +216,7 @@ namespace
       {
         return GetHeaderText(section);
       }
-      return QProxyModel::headerData(section, orientation, role);
+      return sourceModel()->headerData(section, orientation, role);
     }
 
     QVariant data(const QModelIndex& index, int role) const override
@@ -231,7 +232,7 @@ namespace
       }
       else
       {
-        return QProxyModel::data(index, role);
+        return QIdentityProxyModel::data(index, role);
       }
     }
 
diff --git a/apps/zxtune-qt/playlist/ui/playlist_view.h b/apps/zxtune-qt/playlist/ui/playlist_view.h
index 105e57005..347c8c80e 100644
--- a/apps/zxtune-qt/playlist/ui/playlist_view.h
+++ b/apps/zxtune-qt/playlist/ui/playlist_view.h
@@ -13,7 +13,7 @@
 //local includes
 #include "playlist/supp/controller.h"
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 namespace Playlist
 {
diff --git a/apps/zxtune-qt/playlist/ui/scanner_view.cpp b/apps/zxtune-qt/playlist/ui/scanner_view.cpp
index 68a79e558..d467bc9fd 100644
--- a/apps/zxtune-qt/playlist/ui/scanner_view.cpp
+++ b/apps/zxtune-qt/playlist/ui/scanner_view.cpp
@@ -67,7 +67,7 @@ namespace
       //new file started
       if (progress == 0)
       {
-        const QString itemsProgressText = QString::fromAscii("%1/%2%3").arg(Status->DoneFiles()).arg(Status->FoundFiles()).arg(Status->SearchFinished() ? ' ' : '+');
+        const QString itemsProgressText = QString::fromLatin1("%1/%2%3").arg(Status->DoneFiles()).arg(Status->FoundFiles()).arg(Status->SearchFinished() ? ' ' : '+');
         itemsProgress->setText(itemsProgressText);
         itemsProgress->setToolTip(Status->CurrentFile());
       }
diff --git a/apps/zxtune-qt/playlist/ui/scanner_view.h b/apps/zxtune-qt/playlist/ui/scanner_view.h
index 307a258c7..ba18d89e4 100644
--- a/apps/zxtune-qt/playlist/ui/scanner_view.h
+++ b/apps/zxtune-qt/playlist/ui/scanner_view.h
@@ -13,7 +13,7 @@
 //local includes
 #include "playlist/supp/scanner.h"
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 namespace Playlist
 {
diff --git a/apps/zxtune-qt/playlist/ui/table_view.cpp b/apps/zxtune-qt/playlist/ui/table_view.cpp
index 483ade520..d0da6dc1d 100644
--- a/apps/zxtune-qt/playlist/ui/table_view.cpp
+++ b/apps/zxtune-qt/playlist/ui/table_view.cpp
@@ -20,9 +20,9 @@
 //library includes
 #include <debug/log.h>
 //qt includes
-#include <QtGui/QContextMenuEvent>
-#include <QtGui/QHeaderView>
-#include <QtGui/QMenu>
+#include <QContextMenuEvent>
+#include <QHeaderView>
+#include <QMenu>
 
 namespace
 {
@@ -50,8 +50,8 @@ namespace
       setDefaultAlignment(Qt::AlignLeft | Qt::AlignVCenter);
       setHighlightSections(false);
       setTextElideMode(Qt::ElideRight);
-      setMovable(true);
-      setClickable(true);
+      setSectionsMovable(true);
+      setSectionsClickable(true);
       const QFontMetrics fontMetrics(font());
       resizeSection(Playlist::Model::COLUMN_TYPE, fontMetrics.width(TYPE_TEXT));
       resizeSection(Playlist::Model::COLUMN_DISPLAY_NAME, DISPLAYNAME_WIDTH);
@@ -131,7 +131,7 @@ namespace
       if (QHeaderView* const verHeader = verticalHeader())
       {
         verHeader->setDefaultAlignment(Qt::AlignRight | Qt::AlignVCenter);
-        verHeader->setResizeMode(QHeaderView::Fixed);
+        verHeader->setSectionResizeMode(QHeaderView::Fixed);
       }
       setModel(&model);
       
@@ -183,6 +183,7 @@ namespace
       QAbstractItemModel* const curModel = model();
       const QModelIndex idx = curModel->index(index, 0);
       scrollTo(idx, QAbstractItemView::EnsureVisible);
+      selectionModel()->setCurrentIndex(idx, QItemSelectionModel::Rows | QItemSelectionModel::ClearAndSelect);
     }
 
     void SelectItems(Playlist::Model::IndexSet::Ptr indices) override
diff --git a/apps/zxtune-qt/playlist/ui/table_view.h b/apps/zxtune-qt/playlist/ui/table_view.h
index b2854d31f..594d6e834 100644
--- a/apps/zxtune-qt/playlist/ui/table_view.h
+++ b/apps/zxtune-qt/playlist/ui/table_view.h
@@ -15,8 +15,8 @@
 //std includes
 //#include <set>
 //qt includes
-#include <QtGui/QItemDelegate>
-#include <QtGui/QTableView>
+#include <QItemDelegate>
+#include <QTableView>
 
 namespace Playlist
 {
diff --git a/apps/zxtune-qt/qt_app.cpp b/apps/zxtune-qt/qt_app.cpp
index f5049cc45..3c12e28f8 100644
--- a/apps/zxtune-qt/qt_app.cpp
+++ b/apps/zxtune-qt/qt_app.cpp
@@ -19,7 +19,7 @@
 #include <platform/application.h>
 #include <platform/version/api.h>
 //qt includes
-#include <QtGui/QApplication>
+#include <QApplication>
 //std includes
 #include <utility>
 //text includes
diff --git a/apps/zxtune-qt/singlemode.cpp b/apps/zxtune-qt/singlemode.cpp
index dfca1a647..c69b45064 100644
--- a/apps/zxtune-qt/singlemode.cpp
+++ b/apps/zxtune-qt/singlemode.cpp
@@ -18,6 +18,7 @@
 #include <debug/log.h>
 //qt includes
 #include <QtCore/QDir>
+#include <QtCore/QDataStream>
 #include <QtNetwork/QLocalServer>
 #include <QtNetwork/QLocalSocket>
 //text includes
diff --git a/apps/zxtune-qt/ui/controls/analyzer_control.cpp b/apps/zxtune-qt/ui/controls/analyzer_control.cpp
index f9b4fe154..d59002f93 100644
--- a/apps/zxtune-qt/ui/controls/analyzer_control.cpp
+++ b/apps/zxtune-qt/ui/controls/analyzer_control.cpp
@@ -22,7 +22,7 @@
 //qt includes
 #include <QtCore/QEvent>
 #include <QtCore/QTimer>
-#include <QtGui/QPaintEngine>
+#include <QPaintEngine>
 
 namespace
 {
diff --git a/apps/zxtune-qt/ui/controls/analyzer_control.h b/apps/zxtune-qt/ui/controls/analyzer_control.h
index a4882bd78..6f130bbdd 100644
--- a/apps/zxtune-qt/ui/controls/analyzer_control.h
+++ b/apps/zxtune-qt/ui/controls/analyzer_control.h
@@ -13,7 +13,7 @@
 //library includes
 #include <sound/backend.h>
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 class PlaybackSupport;
 
diff --git a/apps/zxtune-qt/ui/controls/overlay_progress.cpp b/apps/zxtune-qt/ui/controls/overlay_progress.cpp
index 4e65e583a..be9e5e032 100644
--- a/apps/zxtune-qt/ui/controls/overlay_progress.cpp
+++ b/apps/zxtune-qt/ui/controls/overlay_progress.cpp
@@ -17,8 +17,8 @@
 #include <cmath>
 #include <utility>
 //qt includes
-#include <QtGui/QMouseEvent>
-#include <QtGui/QPainter>
+#include <QMouseEvent>
+#include <QPainter>
 
 namespace
 {
@@ -83,7 +83,7 @@ namespace
       painter.drawEllipse(QPoint(0, 0), maxRadius, maxRadius);
       painter.setBrush(QBrush());
       painter.drawText(-smallRadius, -smallRadius, smallRadius * 2, smallRadius * 2, Qt::AlignHCenter | Qt::AlignVCenter | Qt::TextSingleLine,
-        QString::fromAscii("%1%").arg(Value));
+        QString::fromLatin1("%1%").arg(Value));
 
       const int totalSteps = std::min(STEPS_MAX, Value * STEPS_MAX / 100 + 1);
       painter.drawLines(Lines.data(), totalSteps);
diff --git a/apps/zxtune-qt/ui/controls/overlay_progress.h b/apps/zxtune-qt/ui/controls/overlay_progress.h
index 8a09e9748..4ee93d5f3 100644
--- a/apps/zxtune-qt/ui/controls/overlay_progress.h
+++ b/apps/zxtune-qt/ui/controls/overlay_progress.h
@@ -11,7 +11,7 @@
 #pragma once
 
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 class OverlayProgress : public QWidget
 {
diff --git a/apps/zxtune-qt/ui/controls/playback_controls.cpp b/apps/zxtune-qt/ui/controls/playback_controls.cpp
index ff8dc5236..7f87cd84a 100644
--- a/apps/zxtune-qt/ui/controls/playback_controls.cpp
+++ b/apps/zxtune-qt/ui/controls/playback_controls.cpp
@@ -18,7 +18,7 @@
 #include <cassert>
 #include <utility>
 //qt includes
-#include <QtGui/QMenu>
+#include <QMenu>
 
 namespace
 {
diff --git a/apps/zxtune-qt/ui/controls/playback_controls.h b/apps/zxtune-qt/ui/controls/playback_controls.h
index e9aa900b2..0b25d3fdd 100644
--- a/apps/zxtune-qt/ui/controls/playback_controls.h
+++ b/apps/zxtune-qt/ui/controls/playback_controls.h
@@ -11,7 +11,7 @@
 #pragma once
 
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 class PlaybackSupport;
 
diff --git a/apps/zxtune-qt/ui/controls/playback_options.h b/apps/zxtune-qt/ui/controls/playback_options.h
index 6cf0f31c6..83faf3437 100644
--- a/apps/zxtune-qt/ui/controls/playback_options.h
+++ b/apps/zxtune-qt/ui/controls/playback_options.h
@@ -15,7 +15,7 @@
 //library includes
 #include <sound/backend.h>
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 class PlaybackSupport;
 
diff --git a/apps/zxtune-qt/ui/controls/seek_controls.cpp b/apps/zxtune-qt/ui/controls/seek_controls.cpp
index 89ae93f3c..053d6623a 100644
--- a/apps/zxtune-qt/ui/controls/seek_controls.cpp
+++ b/apps/zxtune-qt/ui/controls/seek_controls.cpp
@@ -19,8 +19,8 @@
 //library includes
 #include <time/serialize.h>
 //qt includes
-#include <QtGui/QCursor>
-#include <QtGui/QToolTip>
+#include <QCursor>
+#include <QToolTip>
 
 namespace
 {
diff --git a/apps/zxtune-qt/ui/controls/seek_controls.h b/apps/zxtune-qt/ui/controls/seek_controls.h
index e54da674e..246f624cd 100644
--- a/apps/zxtune-qt/ui/controls/seek_controls.h
+++ b/apps/zxtune-qt/ui/controls/seek_controls.h
@@ -15,7 +15,7 @@
 //library includes
 #include <sound/backend.h>
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 class PlaybackSupport;
 
diff --git a/apps/zxtune-qt/ui/controls/status_control.cpp b/apps/zxtune-qt/ui/controls/status_control.cpp
index 314983072..4dcfce8d2 100644
--- a/apps/zxtune-qt/ui/controls/status_control.cpp
+++ b/apps/zxtune-qt/ui/controls/status_control.cpp
@@ -20,8 +20,8 @@
 //std includes
 #include <utility>
 //qt includes
-#include <QtGui/QGridLayout>
-#include <QtGui/QLabel>
+#include <QGridLayout>
+#include <QLabel>
 
 namespace
 {
diff --git a/apps/zxtune-qt/ui/controls/status_control.h b/apps/zxtune-qt/ui/controls/status_control.h
index e14ec481c..29756d0a5 100644
--- a/apps/zxtune-qt/ui/controls/status_control.h
+++ b/apps/zxtune-qt/ui/controls/status_control.h
@@ -13,7 +13,7 @@
 //library includes
 #include <sound/backend.h>
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 class PlaybackSupport;
 
diff --git a/apps/zxtune-qt/ui/controls/volume_control.h b/apps/zxtune-qt/ui/controls/volume_control.h
index 5f8c44ee8..9c505a9c8 100644
--- a/apps/zxtune-qt/ui/controls/volume_control.h
+++ b/apps/zxtune-qt/ui/controls/volume_control.h
@@ -13,7 +13,7 @@
 //library includes
 #include <sound/backend.h>
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 class PlaybackSupport;
 
diff --git a/apps/zxtune-qt/ui/conversion/backend_settings.h b/apps/zxtune-qt/ui/conversion/backend_settings.h
index 08020d4a4..3fb650af5 100644
--- a/apps/zxtune-qt/ui/conversion/backend_settings.h
+++ b/apps/zxtune-qt/ui/conversion/backend_settings.h
@@ -14,7 +14,7 @@
 #include <types.h>
 #include <parameters/container.h>
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 namespace UI
 {
diff --git a/apps/zxtune-qt/ui/conversion/filename_template.cpp b/apps/zxtune-qt/ui/conversion/filename_template.cpp
index c34f6765b..6200f4b69 100644
--- a/apps/zxtune-qt/ui/conversion/filename_template.cpp
+++ b/apps/zxtune-qt/ui/conversion/filename_template.cpp
@@ -22,11 +22,11 @@
 //library includes
 #include <io/providers_parameters.h>
 //qt includes
-#include <QtGui/QCloseEvent>
-#include <QtGui/QDialogButtonBox>
-#include <QtGui/QLineEdit>
-#include <QtGui/QMessageBox>
-#include <QtGui/QVBoxLayout>
+#include <QCloseEvent>
+#include <QDialogButtonBox>
+#include <QLineEdit>
+#include <QMessageBox>
+#include <QVBoxLayout>
 #include <utility>
 
 namespace
diff --git a/apps/zxtune-qt/ui/conversion/filename_template.h b/apps/zxtune-qt/ui/conversion/filename_template.h
index 2258846ff..8d71684d2 100644
--- a/apps/zxtune-qt/ui/conversion/filename_template.h
+++ b/apps/zxtune-qt/ui/conversion/filename_template.h
@@ -11,7 +11,7 @@
 #pragma once
 
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 namespace UI
 {
diff --git a/apps/zxtune-qt/ui/conversion/flac_settings.cpp b/apps/zxtune-qt/ui/conversion/flac_settings.cpp
index 656da49ec..0b46a5433 100644
--- a/apps/zxtune-qt/ui/conversion/flac_settings.cpp
+++ b/apps/zxtune-qt/ui/conversion/flac_settings.cpp
@@ -25,7 +25,7 @@ namespace
 {
   QString Translate(const char* msg)
   {
-    return QApplication::translate("FlacSettings", msg, nullptr, QApplication::UnicodeUTF8);
+    return QApplication::translate("FlacSettings", msg, nullptr);
   }
 
   class FLACSettingsWidget : public UI::BackendSettingsWidget
diff --git a/apps/zxtune-qt/ui/conversion/mp3_settings.cpp b/apps/zxtune-qt/ui/conversion/mp3_settings.cpp
index f02f91238..2dfd4503a 100644
--- a/apps/zxtune-qt/ui/conversion/mp3_settings.cpp
+++ b/apps/zxtune-qt/ui/conversion/mp3_settings.cpp
@@ -29,7 +29,7 @@ namespace
 {
   QString Translate(const char* msg)
   {
-    return QApplication::translate("Mp3Settings", msg, nullptr, QApplication::UnicodeUTF8);
+    return QApplication::translate("Mp3Settings", msg, nullptr);
   }
 
   const Parameters::StringType CHANNEL_MODES[] =
diff --git a/apps/zxtune-qt/ui/conversion/ogg_settings.cpp b/apps/zxtune-qt/ui/conversion/ogg_settings.cpp
index f1895bdbf..103ad89ab 100644
--- a/apps/zxtune-qt/ui/conversion/ogg_settings.cpp
+++ b/apps/zxtune-qt/ui/conversion/ogg_settings.cpp
@@ -25,7 +25,7 @@ namespace
 {
   QString Translate(const char* msg)
   {
-    return QApplication::translate("OggSettings", msg, nullptr, QApplication::UnicodeUTF8);
+    return QApplication::translate("OggSettings", msg, nullptr);
   }
 
   class OGGSettingsWidget : public UI::BackendSettingsWidget
diff --git a/apps/zxtune-qt/ui/conversion/setup_conversion.cpp b/apps/zxtune-qt/ui/conversion/setup_conversion.cpp
index b24cf3c43..927ea8eee 100644
--- a/apps/zxtune-qt/ui/conversion/setup_conversion.cpp
+++ b/apps/zxtune-qt/ui/conversion/setup_conversion.cpp
@@ -31,8 +31,8 @@
 #include <sound/backends_parameters.h>
 //qt includes
 #include <QtCore/QThread>
-#include <QtGui/QCloseEvent>
-#include <QtGui/QPushButton>
+#include <QCloseEvent>
+#include <QPushButton>
 
 namespace
 {
@@ -225,7 +225,7 @@ namespace
     
     static QString MakeFilter(const QString& type)
     {
-      return QString::fromAscii("%1 (*.%1)").arg(type);
+      return QString::fromLatin1("%1 (*.%1)").arg(type);
     }
   private:
     Strings::Array Types;
diff --git a/apps/zxtune-qt/ui/conversion/setup_conversion.h b/apps/zxtune-qt/ui/conversion/setup_conversion.h
index fa19c592f..15b486c45 100644
--- a/apps/zxtune-qt/ui/conversion/setup_conversion.h
+++ b/apps/zxtune-qt/ui/conversion/setup_conversion.h
@@ -14,7 +14,7 @@
 #include "playlist/supp/data.h"
 #include "playlist/supp/conversion.h"
 //qt includes
-#include <QtGui/QDialog>
+#include <QDialog>
 
 namespace UI
 {
diff --git a/apps/zxtune-qt/ui/conversion/supported_formats.cpp b/apps/zxtune-qt/ui/conversion/supported_formats.cpp
index bed845962..1a23263db 100644
--- a/apps/zxtune-qt/ui/conversion/supported_formats.cpp
+++ b/apps/zxtune-qt/ui/conversion/supported_formats.cpp
@@ -23,7 +23,7 @@
 #include <functional>
 #include <set>
 //qt includes
-#include <QtGui/QRadioButton>
+#include <QRadioButton>
 
 namespace
 {
diff --git a/apps/zxtune-qt/ui/conversion/supported_formats.h b/apps/zxtune-qt/ui/conversion/supported_formats.h
index 8aa7bb4d2..631f8a1f6 100644
--- a/apps/zxtune-qt/ui/conversion/supported_formats.h
+++ b/apps/zxtune-qt/ui/conversion/supported_formats.h
@@ -15,7 +15,7 @@
 //library includes
 #include <strings/array.h>
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 namespace UI
 {
diff --git a/apps/zxtune-qt/ui/desktop/mainwindow.cpp b/apps/zxtune-qt/ui/desktop/mainwindow.cpp
index 0260bb276..3075dd41d 100644
--- a/apps/zxtune-qt/ui/desktop/mainwindow.cpp
+++ b/apps/zxtune-qt/ui/desktop/mainwindow.cpp
@@ -39,11 +39,11 @@
 #include <utility>
 //qt includes
 #include <QtCore/QUrl>
-#include <QtGui/QApplication>
-#include <QtGui/QCloseEvent>
-#include <QtGui/QDesktopServices>
-#include <QtGui/QMessageBox>
-#include <QtGui/QToolBar>
+#include <QApplication>
+#include <QCloseEvent>
+#include <QDesktopServices>
+#include <QMessageBox>
+#include <QToolBar>
 //text includes
 #include "text/text.h"
 
diff --git a/apps/zxtune-qt/ui/informational/aboutdialog.cpp b/apps/zxtune-qt/ui/informational/aboutdialog.cpp
index 38891aa39..ca2ca2d82 100644
--- a/apps/zxtune-qt/ui/informational/aboutdialog.cpp
+++ b/apps/zxtune-qt/ui/informational/aboutdialog.cpp
@@ -17,8 +17,8 @@
 //std includes
 #include <utility>
 //qt includes
-#include <QtGui/QApplication>
-#include <QtGui/QDialog>
+#include <QApplication>
+#include <QDialog>
 //text includes
 #include "text/text.h"
 
@@ -37,7 +37,7 @@ namespace
       setupUi(this);
       const QString appVersion(ToQString(Platform::Version::GetProgramVersionString()));
       buildLabel->setText(appVersion);
-      const QString feedbackFormat(QApplication::translate("AboutDialog", FEEDBACK_FORMAT, nullptr, QApplication::UnicodeUTF8));
+      const QString feedbackFormat(QApplication::translate("AboutDialog", FEEDBACK_FORMAT, nullptr));
       feedbackLabel->setText(feedbackFormat.arg(QLatin1String(Text::FEEDBACK_EMAIL)).arg(appVersion));
     }
   };
diff --git a/apps/zxtune-qt/ui/informational/componentsdialog.cpp b/apps/zxtune-qt/ui/informational/componentsdialog.cpp
index 44b317cfc..962a2a394 100644
--- a/apps/zxtune-qt/ui/informational/componentsdialog.cpp
+++ b/apps/zxtune-qt/ui/informational/componentsdialog.cpp
@@ -23,8 +23,8 @@
 //std includes
 #include <utility>
 //qt includes
-#include <QtGui/QApplication>
-#include <QtGui/QDialog>
+#include <QApplication>
+#include <QDialog>
 //text includes
 #include "text/text.h"
 
@@ -32,7 +32,7 @@ namespace
 {
   QString Translate(const char* msg)
   {
-    return QApplication::translate("ComponentsDialog", msg, nullptr, QApplication::UnicodeUTF8);
+    return QApplication::translate("ComponentsDialog", msg, nullptr);
   }
 
   template<class T>
diff --git a/apps/zxtune-qt/ui/mainwindow.h b/apps/zxtune-qt/ui/mainwindow.h
index 93ba38d6b..d8b6dc7f1 100644
--- a/apps/zxtune-qt/ui/mainwindow.h
+++ b/apps/zxtune-qt/ui/mainwindow.h
@@ -12,7 +12,7 @@
 
 //qt includes
 #include <QtCore/QPointer>
-#include <QtGui/QMainWindow>
+#include <QMainWindow>
 
 class MainWindow : public QMainWindow
 {
diff --git a/apps/zxtune-qt/ui/preferences/aym.h b/apps/zxtune-qt/ui/preferences/aym.h
index 670feb558..622a6e9d4 100644
--- a/apps/zxtune-qt/ui/preferences/aym.h
+++ b/apps/zxtune-qt/ui/preferences/aym.h
@@ -11,7 +11,7 @@
 #pragma once
 
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 namespace UI
 {
diff --git a/apps/zxtune-qt/ui/preferences/interface.cpp b/apps/zxtune-qt/ui/preferences/interface.cpp
index 699555343..19bb68ab2 100644
--- a/apps/zxtune-qt/ui/preferences/interface.cpp
+++ b/apps/zxtune-qt/ui/preferences/interface.cpp
@@ -24,7 +24,7 @@
 //library includes
 #include <math/numeric.h>
 //qt includes
-#include <QtGui/QRadioButton>
+#include <QRadioButton>
 //std includes
 #include <utility>
 //boost includes
diff --git a/apps/zxtune-qt/ui/preferences/interface.h b/apps/zxtune-qt/ui/preferences/interface.h
index 6c7b302fe..0c5fd4b98 100644
--- a/apps/zxtune-qt/ui/preferences/interface.h
+++ b/apps/zxtune-qt/ui/preferences/interface.h
@@ -11,7 +11,7 @@
 #pragma once
 
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 namespace UI
 {
diff --git a/apps/zxtune-qt/ui/preferences/mixer.h b/apps/zxtune-qt/ui/preferences/mixer.h
index 07a221b21..bdc6d4c76 100644
--- a/apps/zxtune-qt/ui/preferences/mixer.h
+++ b/apps/zxtune-qt/ui/preferences/mixer.h
@@ -13,7 +13,7 @@
 //library includes
 #include <parameters/container.h>
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 namespace UI
 {
diff --git a/apps/zxtune-qt/ui/preferences/mixing.cpp b/apps/zxtune-qt/ui/preferences/mixing.cpp
index 1b6bf876b..dacdcf196 100644
--- a/apps/zxtune-qt/ui/preferences/mixing.cpp
+++ b/apps/zxtune-qt/ui/preferences/mixing.cpp
@@ -18,7 +18,7 @@
 #include <sound/mixer_parameters.h>
 #include <sound/sample.h>
 //qt includes
-#include <QtGui/QLabel>
+#include <QLabel>
 //std includes
 #include <utility>
 
diff --git a/apps/zxtune-qt/ui/preferences/mixing.h b/apps/zxtune-qt/ui/preferences/mixing.h
index 658923963..a39c78134 100644
--- a/apps/zxtune-qt/ui/preferences/mixing.h
+++ b/apps/zxtune-qt/ui/preferences/mixing.h
@@ -11,7 +11,7 @@
 #pragma once
 
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 namespace UI
 {
diff --git a/apps/zxtune-qt/ui/preferences/plugins.h b/apps/zxtune-qt/ui/preferences/plugins.h
index 98067899e..836463f02 100644
--- a/apps/zxtune-qt/ui/preferences/plugins.h
+++ b/apps/zxtune-qt/ui/preferences/plugins.h
@@ -11,7 +11,7 @@
 #pragma once
 
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 namespace UI
 {
diff --git a/apps/zxtune-qt/ui/preferences/preferencesdialog.cpp b/apps/zxtune-qt/ui/preferences/preferencesdialog.cpp
index d9e84bf5b..9dcbfd051 100644
--- a/apps/zxtune-qt/ui/preferences/preferencesdialog.cpp
+++ b/apps/zxtune-qt/ui/preferences/preferencesdialog.cpp
@@ -25,10 +25,10 @@
 //std includes
 #include <utility>
 //qt includes
-#include <QtGui/QCloseEvent>
-#include <QtGui/QDialogButtonBox>
-#include <QtGui/QTabWidget>
-#include <QtGui/QVBoxLayout>
+#include <QCloseEvent>
+#include <QDialogButtonBox>
+#include <QTabWidget>
+#include <QVBoxLayout>
 
 namespace
 {
diff --git a/apps/zxtune-qt/ui/preferences/preferencesdialog.h b/apps/zxtune-qt/ui/preferences/preferencesdialog.h
index 35ec01b4b..e4acd731b 100644
--- a/apps/zxtune-qt/ui/preferences/preferencesdialog.h
+++ b/apps/zxtune-qt/ui/preferences/preferencesdialog.h
@@ -11,7 +11,7 @@
 #pragma once
 
 //qt includes
-#include <QtGui/QDialog>
+#include <QDialog>
 
 namespace UI
 {
diff --git a/apps/zxtune-qt/ui/preferences/saa.h b/apps/zxtune-qt/ui/preferences/saa.h
index adda9a190..6d361690c 100644
--- a/apps/zxtune-qt/ui/preferences/saa.h
+++ b/apps/zxtune-qt/ui/preferences/saa.h
@@ -11,7 +11,7 @@
 #pragma once
 
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 namespace UI
 {
diff --git a/apps/zxtune-qt/ui/preferences/sid.h b/apps/zxtune-qt/ui/preferences/sid.h
index a4dbed880..70ca8a329 100644
--- a/apps/zxtune-qt/ui/preferences/sid.h
+++ b/apps/zxtune-qt/ui/preferences/sid.h
@@ -11,7 +11,7 @@
 #pragma once
 
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 namespace UI
 {
diff --git a/apps/zxtune-qt/ui/preferences/sound.h b/apps/zxtune-qt/ui/preferences/sound.h
index 99dd05e84..17121131a 100644
--- a/apps/zxtune-qt/ui/preferences/sound.h
+++ b/apps/zxtune-qt/ui/preferences/sound.h
@@ -11,7 +11,7 @@
 #pragma once
 
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 namespace UI
 {
diff --git a/apps/zxtune-qt/ui/preferences/sound_alsa.cpp b/apps/zxtune-qt/ui/preferences/sound_alsa.cpp
index 44397e780..933406187 100644
--- a/apps/zxtune-qt/ui/preferences/sound_alsa.cpp
+++ b/apps/zxtune-qt/ui/preferences/sound_alsa.cpp
@@ -167,7 +167,7 @@ namespace
       }
 
       Device(const Sound::Alsa::Device& in)
-        : Name(QString::fromAscii("%1 (%2)").arg(ToQString(in.Name())).arg(ToQString(in.CardName())))
+        : Name(QString::fromLatin1("%1 (%2)").arg(ToQString(in.Name())).arg(ToQString(in.CardName())))
         , Id(in.Id())
         , MixerNames(ToStringList(in.Mixers()))
       {
diff --git a/apps/zxtune-qt/ui/preferences/sound_oss.cpp b/apps/zxtune-qt/ui/preferences/sound_oss.cpp
index 608dab535..7e6ecf2f1 100644
--- a/apps/zxtune-qt/ui/preferences/sound_oss.cpp
+++ b/apps/zxtune-qt/ui/preferences/sound_oss.cpp
@@ -18,7 +18,7 @@
 //library includes
 #include <sound/backends_parameters.h>
 //qt includes
-#include <QtGui/QFileDialog>
+#include <QFileDialog>
 //std includes
 #include <utility>
 
diff --git a/apps/zxtune-qt/ui/preferences/z80.h b/apps/zxtune-qt/ui/preferences/z80.h
index 218199207..942c15df6 100644
--- a/apps/zxtune-qt/ui/preferences/z80.h
+++ b/apps/zxtune-qt/ui/preferences/z80.h
@@ -11,7 +11,7 @@
 #pragma once
 
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 namespace UI
 {
diff --git a/apps/zxtune-qt/ui/state.cpp b/apps/zxtune-qt/ui/state.cpp
index 170f03ad5..5efb96fd6 100644
--- a/apps/zxtune-qt/ui/state.cpp
+++ b/apps/zxtune-qt/ui/state.cpp
@@ -21,13 +21,13 @@
 #include <parameters/convert.h>
 //qt includes
 #include <QtCore/QByteArray>
-#include <QtGui/QAbstractButton>
-#include <QtGui/QComboBox>
-#include <QtGui/QDialog>
-#include <QtGui/QFileDialog>
-#include <QtGui/QHeaderView>
-#include <QtGui/QMainWindow>
-#include <QtGui/QTabWidget>
+#include <QAbstractButton>
+#include <QComboBox>
+#include <QDialog>
+#include <QFileDialog>
+#include <QHeaderView>
+#include <QMainWindow>
+#include <QTabWidget>
 
 namespace
 {
diff --git a/apps/zxtune-qt/ui/styles.cpp b/apps/zxtune-qt/ui/styles.cpp
index e782a2798..4d3ce6245 100644
--- a/apps/zxtune-qt/ui/styles.cpp
+++ b/apps/zxtune-qt/ui/styles.cpp
@@ -11,8 +11,8 @@
 //local includes
 #include "styles.h"
 //qt includes
-#include <QtGui/QApplication>
-#include <QtGui/QProxyStyle>
+#include <QApplication>
+#include <QProxyStyle>
 //std includes
 #include <utility>
 
diff --git a/apps/zxtune-qt/ui/tools/errordialog.cpp b/apps/zxtune-qt/ui/tools/errordialog.cpp
index 53b694ef2..dc49233cc 100644
--- a/apps/zxtune-qt/ui/tools/errordialog.cpp
+++ b/apps/zxtune-qt/ui/tools/errordialog.cpp
@@ -12,7 +12,7 @@
 #include "errordialog.h"
 #include "ui/utils.h"
 //qt includes
-#include <QtGui/QMessageBox>
+#include <QMessageBox>
 //std includes
 #include <utility>
 
diff --git a/apps/zxtune-qt/ui/tools/errorswidget.cpp b/apps/zxtune-qt/ui/tools/errorswidget.cpp
index e274cb657..75095945b 100644
--- a/apps/zxtune-qt/ui/tools/errorswidget.cpp
+++ b/apps/zxtune-qt/ui/tools/errorswidget.cpp
@@ -18,8 +18,8 @@
 #include <cassert>
 #include <list>
 //qt includes
-#include <QtGui/QLabel>
-#include <QtGui/QPainter>
+#include <QLabel>
+#include <QPainter>
 //std includes
 #include <utility>
 
diff --git a/apps/zxtune-qt/ui/tools/errorswidget.h b/apps/zxtune-qt/ui/tools/errorswidget.h
index 122776f98..1cced5dd4 100644
--- a/apps/zxtune-qt/ui/tools/errorswidget.h
+++ b/apps/zxtune-qt/ui/tools/errorswidget.h
@@ -13,7 +13,7 @@
 //common includes
 #include <error.h>
 //common includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 namespace UI
 {
diff --git a/apps/zxtune-qt/ui/tools/filedialog.cpp b/apps/zxtune-qt/ui/tools/filedialog.cpp
index aed65e0d0..dd7664720 100644
--- a/apps/zxtune-qt/ui/tools/filedialog.cpp
+++ b/apps/zxtune-qt/ui/tools/filedialog.cpp
@@ -14,7 +14,7 @@
 #include "ui/state.h"
 #include "ui/utils.h"
 //qt includes
-#include <QtGui/QFileDialog>
+#include <QFileDialog>
 //std includes
 #include <utility>
 
diff --git a/apps/zxtune-qt/ui/tools/parameters_helpers.cpp b/apps/zxtune-qt/ui/tools/parameters_helpers.cpp
index cf17075cb..e47f7b375 100644
--- a/apps/zxtune-qt/ui/tools/parameters_helpers.cpp
+++ b/apps/zxtune-qt/ui/tools/parameters_helpers.cpp
@@ -16,13 +16,13 @@
 #include <debug/log.h>
 #include <math/numeric.h>
 //qt includes
-#include <QtGui/QAbstractButton>
-#include <QtGui/QAction>
-#include <QtGui/QComboBox>
-#include <QtGui/QGroupBox>
-#include <QtGui/QLineEdit>
-#include <QtGui/QSlider>
-#include <QtGui/QSpinBox>
+#include <QAbstractButton>
+#include <QAction>
+#include <QComboBox>
+#include <QGroupBox>
+#include <QLineEdit>
+#include <QSlider>
+#include <QSpinBox>
 
 namespace
 {
diff --git a/apps/zxtune-qt/ui/utils.h b/apps/zxtune-qt/ui/utils.h
index f25973ac2..44999fa9f 100644
--- a/apps/zxtune-qt/ui/utils.h
+++ b/apps/zxtune-qt/ui/utils.h
@@ -13,6 +13,7 @@
 //common includes
 #include <types.h>
 //qt includes
+#include <QtCore/QObject>
 #include <QtCore/QString>
 #include <QtCore/QMetaType>
 
diff --git a/apps/zxtune-qt/update/check.cpp b/apps/zxtune-qt/update/check.cpp
index 8f1fffec3..9e2765176 100644
--- a/apps/zxtune-qt/update/check.cpp
+++ b/apps/zxtune-qt/update/check.cpp
@@ -29,10 +29,10 @@
 #include <utility>
 //qt includes
 #include <QtCore/QTimer>
-#include <QtGui/QApplication>
-#include <QtGui/QFileDialog>
-#include <QtGui/QMessageBox>
-#include <QtGui/QProgressDialog>
+#include <QApplication>
+#include <QFileDialog>
+#include <QMessageBox>
+#include <QProgressDialog>
 
 namespace
 {
diff --git a/apps/zxtune-qt/update/check.h b/apps/zxtune-qt/update/check.h
index 4f354e5b0..d24ad2927 100644
--- a/apps/zxtune-qt/update/check.h
+++ b/apps/zxtune-qt/update/check.h
@@ -11,7 +11,7 @@
 #pragma once
 
 //qt includes
-#include <QtGui/QWidget>
+#include <QWidget>
 
 class Error;
 
diff --git a/make/qt.mak b/make/qt.mak
index 243311aae..8777e7c17 100644
--- a/make/qt.mak
+++ b/make/qt.mak
@@ -26,7 +26,7 @@ libraries.dirs.$(platform) += $(qt.dir)/lib
 qt.bin = $(qt.dir)/bin/
 endif
 
-libraries += $(foreach lib,$(libraries.qt),Qt$(lib))
+libraries += $(foreach lib,$(libraries.qt),Qt5$(lib))
 
 ifneq (,$(findstring Core,$(libraries.qt)))
 libraries.windows += Qtmain kernel32 user32 shell32 uuid ole32 advapi32 ws2_32 oldnames
-- 
2.29.1

