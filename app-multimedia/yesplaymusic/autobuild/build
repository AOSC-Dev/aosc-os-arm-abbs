abinfo "Installing Dependencies ..."
npm install -g yarn
yarn install

abinfo " Setting Local Env ... "
cp -av "$SRCDIR"/.env.example "$SRCDIR"/.env

abinfo " Building Yesplaymusic  ... "
yarn electron:build --dir

abinfo "Installing Yesplaymusic ..."
if ab_match_arch arm64 ; then
	ELECTRONDIR="$SRCDIR"/dist_electron/linux-arm64-unpacked
else
	ELECTRONDIR="$SRCDIR"/dist_electron/linux-unpacked
fi
# NOTE no trailing slash here.
mkdir -pv "$PKGDIR"/usr/share/yesplaymusic/
cp -av "$SRCDIR"/dist_electron/bundled/img/icons/icon.ico \
	"$PKGDIR"/usr/share/yesplaymusic/favicon.ico
install -dvm755 "$PKGDIR"/usr/lib
cp -av "$ELECTRONDIR" "$PKGDIR"/usr/lib/yesplaymusic
install -Dvm755 -t "$PKGDIR"/usr/share/doc/yesplaymusic \
    "$ELECTRONDIR"/*LICENSE*

abinfo "Installing icons ..."
for size in 16x16 24x24 32x32 48x48 64x64 128x128 256x256 512x512 1024x1024 ; do
	install -Dvm644 "$SRCDIR"/build/icons/$size.png \
		"$PKGDIR"/usr/share/icons/hicolor/$size/apps/yesplaymusic.png
done
