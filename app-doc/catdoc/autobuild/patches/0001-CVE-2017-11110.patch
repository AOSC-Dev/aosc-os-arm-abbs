From 0afca1be9fb3cdd500d61e66dc9e459ff81a9770 Mon Sep 17 00:00:00 2001
From: salieri <maliya355@outlook.com>
Date: Wed, 5 Jun 2024 11:28:34 +0800
Subject: [PATCH] CVE-2017-11110: Heap buffer overflow in ole_init

Description: CVE-2017-11110: Heap buffer overflow in ole_init
Origin: vendor, https://build.opensuse.org/package/view_file/openSUSE:Maintenance:6985/catdoc.openSUSE_Leap_42.2_Update/CVE-2017-11110.patch?rev=d437c3be72c2e5a3516b75f4e9de6b35
Bug-Debian: https://bugs.debian.org/867717
Bug-Debian-Security: https://security-tracker.debian.org/tracker/CVE-2017-11110
Bug-SuSE: https://bugzilla.novell.com/show_bug.cgi?id=1047877
Forwarded: no
Author: Andreas Stieger <astieger@suse.com>
Reviewed-by: Salvatore Bonaccorso <carnil@debian.org>
Last-Update: 2017-07-20

---
 src/ole.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/src/ole.c b/src/ole.c
index dbcda42..27b67bb 100644
--- a/src/ole.c
+++ b/src/ole.c
@@ -106,6 +106,11 @@ FILE* ole_init(FILE *f, void *buffer, size_t bufSize)  {
 		return NULL;
 	}
  	sectorSize = 1<<getshort(oleBuf,0x1e);
+	/* CVE-2017-11110 */
+	if (sectorSize < 4) {
+		fprintf(stderr, "sectorSize < 4 not supported\n");
+		return NULL;
+	}
 	shortSectorSize=1<<getshort(oleBuf,0x20);
 
 /* Read BBD into memory */
@@ -147,7 +152,7 @@ FILE* ole_init(FILE *f, void *buffer, size_t bufSize)  {
 		}
 
 		fseek(newfile, 512+mblock*sectorSize, SEEK_SET);
-		if(fread(tmpBuf+MSAT_ORIG_SIZE+(sectorSize-4)*i,
+		if(fread(tmpBuf+MSAT_ORIG_SIZE+(sectorSize-4)*i, /* >=4 for CVE-2017-11110 */
 						 1, sectorSize, newfile) != sectorSize) {
 			fprintf(stderr, "Error read MSAT!\n");
 			ole_finish();
-- 
2.34.1

