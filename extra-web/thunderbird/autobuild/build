export CC=gcc
export CXX=g++
export LDFLAGS="$LDFLAGS -Wl,-rpath,/usr/lib/thunderbird"

make -f client.mk build MOZ_MAKE_FLAGS=${MAKEFLAGS/ /}

make -j1 -f client.mk DESTDIR="$PKGDIR" install

for i in 16x16 22x22 24x24 32x32 48x48 256x256; do
    install -Dm644 other-licenses/branding/thunderbird/mailicon${i/x*/}.png \
        "$PKGDIR"/usr/share/icons/hicolor/$i/apps/thunderbird.png
done

rm -r "$PKGDIR"/usr/{include,lib/thunderbird-devel-*,share/idl}

wget --no-parent --recursive -c -A '*.xpi' \
    http://download-origin.cdn.mozilla.net/pub/thunderbird/releases/$PKGVER/linux-i686/xpi/

mkdir -p "$PKGDIR"/usr/lib/thunderbird/extensions/

for i in `ls download-origin.cdn.mozilla.net/pub/thunderbird/releases/$PKGVER/linux-i686/xpi/ | sed s/.xpi//g`; do
    cp -v download-origin.cdn.mozilla.net/pub/thunderbird/releases/$PKGVER/linux-i686/xpi/$i.xpi \
        "$PKGDIR"/usr/lib/thunderbird/extensions/langpack-$i@thunderbird.mozilla.org.xpi
done
