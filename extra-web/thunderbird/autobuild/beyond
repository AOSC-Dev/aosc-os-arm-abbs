if [[ "${CROSS:-$ARCH}" = "loongson3" || "${CROSS:-$ARCH}" = "riscv64" ]]; then
    abwarn "Skipping RNP replacement as it's not worth it on this architecture."
    return;
fi

abinfo "Restoring RUSTFLAGS ..."
export RUSTFLAGS="${__RUSTFLAGS}"

abinfo "Building sequoia-octopus-rnp for more secure OpenGPG integration ..."
(
  cd "$SRCDIR"/../
  bsdtar -xf librnp.tar.gz
  cd "sequoia-octopus-librnp-v${__SEQUOIA_RNP_VERSION}"
  abinfo "Building Sequoia Replacement RNP library ..."
  cargo build --release --locked
  abinfo "Replacing the unsecure RNP library ..."
  install -Dvm755 ./target/release/libsequoia_octopus_librnp.so "$PKGDIR"/usr/lib/thunderbird/librnp.so
)
