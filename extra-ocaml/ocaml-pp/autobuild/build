# Using AB3's build/15-dune.sh will install unneeded integrated test component,
# which depends on an unavailable package `ppx_expect`.

abinfo "Building Dune project $PKGNAME ..."
    dune build -p pp
abinfo "Installing Dune project $PKGNAME ..."
mkdir -pv "$PKGDIR"/"$(ocamlfind printconf destdir)"
dune install \
    --prefix "$PKGDIR"/usr \
    --libdir "$PKGDIR"/"$(ocamlfind printconf destdir)"

abinfo "Correcting directories ..."
if [ -d "$PKGDIR"/usr/doc ]; then
    mkdir -pv "$PKGDIR"/usr/share
    mv -v "$PKGDIR"/usr/{,share/}doc
fi
if [ -d "$PKGDIR"/usr/man ]; then
    mkdir -pv "$PKGDIR"/usr/share
    mv -v "$PKGDIR"/usr/{,share/}man
fi
