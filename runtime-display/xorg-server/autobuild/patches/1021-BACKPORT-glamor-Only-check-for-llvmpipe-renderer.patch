From e7635e420cf3d9061315c4ea854c0d95453a4042 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Corentin=20No=C3=ABl?= <corentin.noel@collabora.com>
Date: Mon, 1 Aug 2022 16:03:38 +0200
Subject: [PATCH 021/105] glamor: Only check for llvmpipe renderer
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

The virgl driver exposes the name of the host renderer which might be llvmpipe.
In this case we still need glamor to be initialized.

Only check if the renderer starts with llvmpipe (which is what llvmpipe exposes).

Signed-off-by: Corentin NoÃ«l <corentin.noel@collabora.com>
Reviewed-by: Adam Jackson <ajax@redhat.com>
Signed-off-by: Icenowy Zheng <uwu@icenowy.me>
---
 glamor/glamor_egl.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/glamor/glamor_egl.c b/glamor/glamor_egl.c
index aa82a5608..e2a2a1050 100644
--- a/glamor/glamor_egl.c
+++ b/glamor/glamor_egl.c
@@ -1080,7 +1080,7 @@ glamor_egl_init(ScrnInfoPtr scrn, int fd)
                    "glGetString() returned NULL, your GL is broken\n");
         goto error;
     }
-    if (strstr((const char *)renderer, "llvmpipe")) {
+    if (!strncmp("llvmpipe", (const char *)renderer, strlen("llvmpipe"))) {
         if (scrn->confScreen->num_gpu_devices)
             xf86DrvMsg(scrn->scrnIndex, X_INFO,
                        "Allowing glamor on llvmpipe for PRIME\n");
-- 
2.45.2

