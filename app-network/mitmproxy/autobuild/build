mv -v mitmproxy-* mitmproxy
mv -v mitmproxy_rs-* mitmproxy_rs

(
    cd mitmproxy_rs || exit
    # shellcheck disable=SC2030
    export SRCDIR="$SRCDIR/mitmproxy_rs"
    abinfo "Building mitmproxy-rs ..."
    maturin build

    abinfo "Installing mitmproxy-rs to build environment ..."
    # then mitmproxy will not fail to build for dependency not found
    python3 \
        -m installer \
        "$SRCDIR"/target/wheels/*.whl

    abinfo "Installing mitmproxy-rs to package ..."
    python3 \
        -m installer \
        --destdir="$PKGDIR" \
        "$SRCDIR"/target/wheels/*.whl
)

(
    cd mitmproxy || exit
    # shellcheck disable=SC2031
    export SRCDIR="$SRCDIR/mitmproxy"
    abinfo "Configuring mitmproxy ..."
    build_pep517_configure

    abinfo "Building mitmproxy ..."
    build_pep517_build

    abinfo "Installing mitmproxy ..."
    build_pep517_install
)
