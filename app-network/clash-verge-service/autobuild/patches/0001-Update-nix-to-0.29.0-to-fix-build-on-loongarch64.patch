From 1c661ef6a7d56eaece9a5fecc8a4dad92419b34c Mon Sep 17 00:00:00 2001
From: eatradish <sakiiily@aosc.io>
Date: Mon, 13 Jan 2025 16:38:11 +0800
Subject: [PATCH] Update nix to 0.29.0 to fix build on loongarch64

---
 Cargo.lock         | 25 +++++++++++++++++++++----
 Cargo.toml         |  3 +--
 src/service/web.rs |  1 +
 3 files changed, 23 insertions(+), 6 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index 1023f32..4c8e99a 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -1,6 +1,6 @@
 # This file is automatically @generated by Cargo.
 # It is not intended for manual editing.
-version = 3
+version = 4
 
 [[package]]
 name = "addr2line"
@@ -122,6 +122,12 @@ version = "1.0.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "baf1de4339761588bc0619e3cbc0120ee582ebb74b53b4efbf79117bd2da40fd"
 
+[[package]]
+name = "cfg_aliases"
+version = "0.2.1"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "613afe47fcd5fac7ccf1db93babcb082c5994d996f20b8b159f2ad1658eb5724"
+
 [[package]]
 name = "chrono"
 version = "0.4.38"
@@ -140,10 +146,9 @@ version = "0.1.0"
 dependencies = [
  "anyhow",
  "interfaces",
- "libc",
  "log",
  "log4rs",
- "nix",
+ "nix 0.29.0",
  "once_cell",
  "openssl",
  "parking_lot",
@@ -687,7 +692,7 @@ dependencies = [
  "handlebars",
  "lazy_static",
  "libc",
- "nix",
+ "nix 0.26.4",
  "serde",
  "serde_derive",
 ]
@@ -860,6 +865,18 @@ dependencies = [
  "pin-utils",
 ]
 
+[[package]]
+name = "nix"
+version = "0.29.0"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "71e2746dc3a24dd78b3cfcb7be93368c6de9963d30f43a6a73998a9cf4b17b46"
+dependencies = [
+ "bitflags 2.5.0",
+ "cfg-if",
+ "cfg_aliases",
+ "libc",
+]
+
 [[package]]
 name = "ntapi"
 version = "0.4.1"
diff --git a/Cargo.toml b/Cargo.toml
index 2b1a3cc..f003c09 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -30,8 +30,7 @@ windows-service = "0.7.0"
 tokio = { version = "1", features = ["full"] }
 serde = { version = "1.0", features = ["derive"] }
 sysinfo = "0.31.4"
-nix = "0.26"
-libc = "0.2"
+nix = { version = "0.29", features = ["signal"] }
 
 [target.'cfg(target_os = "linux")'.dependencies]
 openssl = { version = "0.10", features = ["vendored"] }
diff --git a/src/service/web.rs b/src/service/web.rs
index e147711..ce472be 100644
--- a/src/service/web.rs
+++ b/src/service/web.rs
@@ -1,5 +1,6 @@
 use super::data::*;
 use anyhow::{bail, Context, Result};
+use nix::libc;
 use once_cell::sync::OnceCell;
 use parking_lot::Mutex;
 use std::collections::HashMap;
-- 
2.47.1

