PKGNAME=yuzu
PKGSEC=games
PKGDEP="boost enet ffmpeg fmt gcc-runtime inih libusb libzip lz4 \
        openssl pkcs11-helper qt-5 sdl2 zlib zstd"
BUILDDEP="catch2 conan doxygen glslang llvm nlohmann-json rapidjson \
          spirv-headers vulkan-headers"
PKGDES="An emulator for the Nintendo Switch"

# Note: 
#    - "EXTERNAL" really means bundled here ($SRCDIR/externals).
#    - Bundle a few dependencies as exceptions: core, header-only, upstream,
#      and version-sensitive (those that are difficult to follow) dependencies
#      (Cubeb, Dynarmic, Xbyak, Zydis, etc.). Use static libraries for bundled
#      dependencies.
CMAKE_AFTER="-DBUILD_RUST_LIBS=ON \
             -DBUILD_SHARED_LIBS=OFF \
             -DBUILD_TESTS=OFF \
             -DBUILD_TOOLS=ON \
             -DBUNDLE_SPEEX=OFF \
             -DDYNARMIC_ENABLE_CPU_FEATURE_DETECTION=ON \
             -DDYNARMIC_ENABLE_NO_EXECUTE_SUPPORT=ON \
             -DDYNARMIC_USE_LLVM=ON \
             -DENABLE_CUBEB=ON \
             -DENABLE_IO_THREAD=ON \
             -DENABLE_PROGRAMS=ON \
             -DENABLE_QT=ON \
             -DENABLE_QT_TRANSLATION=ON \
             -DENABLE_SDL2=ON \
             -DENABLE_TESTING=OFF \
             -DENABLE_WEB_SERVICE=ON \
             -DENABLE_ZLIB_SUPPORT=ON \
             -DGENERATE_QT_TRANSLATION=ON \
             -DHIDAPI=ON \
             -DINSTALL_MBEDTLS_HEADERS=OFF \
             -DJACK_LIB=ON \
             -DSPIRIT_TESTS=OFF \
             -DSIRIT_USE_SYSTEM_SPIRV_HEADERS=ON \
             -DSPIRV_HEADERS_SKIP_EXAMPLES=ON \
             -DSPIRV_HEADERS_SKIP_INSTALL=ON \
             -DUSE_DISCORD_PRESENCE=ON \
             -DUSE_PKCS11_HELPER_LIBRARY=ON \
             -DUSE_SANITIZERS=OFF \
             -DUSE_SHARED_MBEDTLS_LIBRARY=OFF \
             -DUSE_STATIC_CRT=OFF \
             -DUSE_STATIC_MBEDTLS_LIBRARY=ON \
             -DYUZU_USE_BUNDLED_CPP_JWT=ON \
             -DYUZU_USE_BUNDLED_CUBEB=ON \
             -DYUZU_USE_BUNDLED_DISCORD_PRESENCE=ON \
             -DYUZU_USE_BUNDLED_DYNARMIC=ON \
             -DYUZU_USE_BUNDLED_ENET=OFF \
             -DYUZU_USE_BUNDLED_FFMPEG=OFF \
             -DYUZU_USE_BUNDLED_HTTPLIB=ON \
             -DYUZU_USE_BUNDLED_INIH=OFF \
             -DYUZU_USE_BUNDLED_LIBUSB=OFF \
             -DYUZU_USE_BUNDLED_OPUS=OFF \
             -DYUZU_USE_BUNDLED_QT=OFF \
             -DYUZU_USE_BUNDLED_VCPKG=OFF \
             -DYUZU_USE_BUNDLED_VULKAN_HEADERS=OFF \
             -DYUZU_USE_BUNDLED_XBYAK=ON \
             -DYUZU_USE_EXTERNAL_SDL2=OFF \
             -DYUZU_USE_QT_WEB_ENGINE=ON \
             -DZYAN_DEV_MODE=OFF \
             -DZYAN_NO_LIBC=OFF \
             -DZYAN_WHOLE_PROGRAM_OPTIMIZATION=ON \
             -DZYCORE_BUILD_EXAMPLES=OFF \
             -DZYCORE_BUILD_SHARED_LIB=OFF \
             -DZYCORE_BUILD_TESTS=OFF \
             -DZYDIS_BUILD_EXAMPLES=OFF \
             -DZYDIS_BUILD_SHARED_LIB=OFF \
             -DZYDIS_BUILD_TOOLS=ON \
             -DZYDIS_FEATURE_AVX512=ON \
             -DZYDIS_FEATURE_DECODER=ON \
             -DZYDIS_FEATURE_FORMATTER=ON \
             -DZYDIS_FEATURE_KNC=ON \
             -DZYDIS_FUZZ_AFL_FAST=OFF \
             -DZYDIS_LIBFUZZER=OFF \
             -DZYDIS_MINIMAL_MODE=OFF \
             -DDISPLAY_VERSION=mainline-${PKGVER/+/-}"

USECLANG=1

FAIL_ARCH="!(amd64)"

PKGEPOCH=1
