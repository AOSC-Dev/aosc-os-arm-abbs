abinfo "Preparing to build Python bindings separately ..."
# Adpated from Debian
PYBLDDIR="$SRCDIR"/abpybuild
mkdir -pv "$PYBLDDIR"
cd "$PYBLDDIR"

abinfo "Configuring Python binding source tree ..."
"$SRCDIR"/configure $AUTOTOOLS_DEF ${AUTOTOOLS_AFTER/--without-python/}
rm -rv "$PYBLDDIR"/lib
ln -sv "$BLDDIR"/lib "$PYBLDDIR"/lib

abinfo "Building Python bindings using $PYTHON ..."
"$PYTHON" "$PYBLDDIR"/python/setup.py build

abinfo "Installing Python bindings using $PYTHON ..."
"$PYTHON" "$PYBLDDIR"/python/setup.py install \
    --prefix=/usr --root="$PKGDIR" --optimize=1

abinfo "Cleaning Python binding source tree ..."
"$PYTHON" "$PYBLDDIR"/python/setup.py clean

cd "$SRCDIR"

./util/cracklib-format cracklib-dicts/* | \
./util/cracklib-packer "$PKGDIR"/usr/share/cracklib/pw_dict
./util/cracklib-format "$PKGDIR"/usr/share/cracklib/cracklib-small | \
./util/cracklib-packer "$PKGDIR"/usr/share/cracklib/cracklib-small
rm -f "$PKGDIR"/usr/share/cracklib/cracklib-small

sed -e 's|/usr/lib/cracklib_dict|/usr/share/cracklib/pw_dict|g' \
    lib/crack.h > "$PKGDIR"/usr/include/crack.h
ln -s cracklib-format "$PKGDIR"/usr/bin/mkdict
ln -s cracklib-packer "$PKGDIR"/usr/bin/packer

ln -s ../share/cracklib/pw_dict.hwm "$PKGDIR"/usr/lib/cracklib_dict.hwm
ln -s ../share/cracklib/pw_dict.pwd "$PKGDIR"/usr/lib/cracklib_dict.pwd
ln -s ../share/cracklib/pw_dict.pwi "$PKGDIR"/usr/lib/cracklib_dict.pwi
