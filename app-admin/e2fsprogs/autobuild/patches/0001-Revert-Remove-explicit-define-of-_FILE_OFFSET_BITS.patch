From 99978339bd1633ef484566b746a1fed7baa46bca Mon Sep 17 00:00:00 2001
From: Kexy Biscuit <kexybiscuit@aosc.io>
Date: Thu, 18 Jul 2024 06:35:45 +0800
Subject: [PATCH] Revert "Remove explicit #define of _FILE_OFFSET_BITS"

This reverts commit 3ab99d9b6022ffa369e8ce7ae5643a30028d0db1.
---
 lib/ext2fs/getenv.c            | 7 +++++++
 lib/ext2fs/unix_io.c           | 1 +
 misc/create_inode.c            | 1 +
 misc/create_inode_libarchive.c | 1 +
 misc/e2fuzz.c                  | 1 +
 misc/findsuper.c               | 2 ++
 misc/fuse2fs.c                 | 1 +
 util/symlinks.c                | 8 ++++++++
 8 files changed, 22 insertions(+)

diff --git a/lib/ext2fs/getenv.c b/lib/ext2fs/getenv.c
index 409a78ac..f279f7b4 100644
--- a/lib/ext2fs/getenv.c
+++ b/lib/ext2fs/getenv.c
@@ -12,6 +12,13 @@
 #if !defined(__FreeBSD__) && !defined(__NetBSD__) && !defined(__OpenBSD__)
 #define _XOPEN_SOURCE 600
 #define _DARWIN_C_SOURCE
+#define _FILE_OFFSET_BITS 64
+#ifndef _LARGEFILE_SOURCE
+#define _LARGEFILE_SOURCE
+#endif
+#ifndef _LARGEFILE64_SOURCE
+#define _LARGEFILE64_SOURCE
+#endif
 #ifndef _GNU_SOURCE
 #define _GNU_SOURCE
 #endif
diff --git a/lib/ext2fs/unix_io.c b/lib/ext2fs/unix_io.c
index 4b4f25a4..b06df068 100644
--- a/lib/ext2fs/unix_io.c
+++ b/lib/ext2fs/unix_io.c
@@ -18,6 +18,7 @@
 #if !defined(__FreeBSD__) && !defined(__NetBSD__) && !defined(__OpenBSD__)
 #define _XOPEN_SOURCE 600
 #define _DARWIN_C_SOURCE
+#define _FILE_OFFSET_BITS 64
 #ifndef _LARGEFILE_SOURCE
 #define _LARGEFILE_SOURCE
 #endif
diff --git a/misc/create_inode.c b/misc/create_inode.c
index 4e292a2d..e2676a05 100644
--- a/misc/create_inode.c
+++ b/misc/create_inode.c
@@ -9,6 +9,7 @@
  * %End-Header%
  */
 
+#define _FILE_OFFSET_BITS       64
 #define _LARGEFILE64_SOURCE     1
 #define _GNU_SOURCE		1
 
diff --git a/misc/create_inode_libarchive.c b/misc/create_inode_libarchive.c
index 8705eb16..ebd62d44 100644
--- a/misc/create_inode_libarchive.c
+++ b/misc/create_inode_libarchive.c
@@ -9,6 +9,7 @@
  * %End-Header%
  */
 
+#define _FILE_OFFSET_BITS 64
 #define _LARGEFILE64_SOURCE 1
 #define _GNU_SOURCE 1
 
diff --git a/misc/e2fuzz.c b/misc/e2fuzz.c
index 9f60bcf4..0ceece9e 100644
--- a/misc/e2fuzz.c
+++ b/misc/e2fuzz.c
@@ -9,6 +9,7 @@
  * %End-Header%
  */
 #define _XOPEN_SOURCE		600
+#define _FILE_OFFSET_BITS       64
 #define _LARGEFILE64_SOURCE     1
 #define _GNU_SOURCE		1
 
diff --git a/misc/findsuper.c b/misc/findsuper.c
index 8f275eac..1f5c3e72 100644
--- a/misc/findsuper.c
+++ b/misc/findsuper.c
@@ -81,6 +81,8 @@
  *
  */
 
+#define _FILE_OFFSET_BITS 64
+
 #include "config.h"
 #include <stdio.h>
 #include <stdlib.h>
diff --git a/misc/fuse2fs.c b/misc/fuse2fs.c
index 56a0d545..5927fdf9 100644
--- a/misc/fuse2fs.c
+++ b/misc/fuse2fs.c
@@ -8,6 +8,7 @@
  * License.
  * %End-Header%
  */
+#define _FILE_OFFSET_BITS 64
 #ifndef _GNU_SOURCE
 #define _GNU_SOURCE
 #endif
diff --git a/util/symlinks.c b/util/symlinks.c
index 4c721560..e9d2b011 100644
--- a/util/symlinks.c
+++ b/util/symlinks.c
@@ -1,3 +1,11 @@
+#define _FILE_OFFSET_BITS 64
+#ifndef _LARGEFILE_SOURCE
+#define _LARGEFILE_SOURCE
+#endif
+#ifndef _LARGEFILE64_SOURCE
+#define _LARGEFILE64_SOURCE
+#endif
+
 #include <unistd.h>
 #ifndef _POSIX_SOURCE
 #define _POSIX_SOURCE
-- 
2.46.0.rc0.windows.1

