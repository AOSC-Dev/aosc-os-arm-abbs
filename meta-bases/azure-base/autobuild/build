# Note: https://learn.microsoft.com/en-us/azure/virtual-machines/linux/create-upload-generic for more information

abinfo "Adding hv_vmbus hv_netvsc hv_storvsc to draut drivers ..."
mkdir -p "$PKGDIR"/etc/dracut.conf.d
cat > "$PKGDIR"/etc/dracut.conf.d/hv.conf << EOF
add_drivers+="hv_vmbus hv_netvsc hv_storvsc"
EOF

abinfo "Adding required Kernel command-line options for Azure ..."
mkdir -p "$PKGDIR"/etc/default/grub.d
cat > "$PKGDIR"/etc/default/grub.d/azure.cfg << EOF
GRUB_CMDLINE_LINUX_DEFAULT="rw rd.auto rd.auto=1 rootdelay=300 console=ttyS0 earlyprintk=ttyS0 net.ifnames=0"
EOF
