From c8a14e63689dfba283935b00d29fe24a9dcdf977 Mon Sep 17 00:00:00 2001
From: Andrew Cantino <cantino@users.noreply.github.com>
Date: Thu, 17 Feb 2022 12:56:19 -0800
Subject: [PATCH 1/3] Try warning instead of paniking

---
 src/history/history.rs | 20 ++++++++++----------
 1 file changed, 10 insertions(+), 10 deletions(-)

diff --git a/src/history/history.rs b/src/history/history.rs
index c64e572..b53b588 100644
--- a/src/history/history.rs
+++ b/src/history/history.rs
@@ -806,16 +806,16 @@ impl History {
                 if !IGNORED_COMMANDS.contains(&command.command.as_str()) {
                     let simplified_command = SimplifiedCommand::new(&command.command, true);
                     if !command.command.is_empty() && !simplified_command.result.is_empty() {
-                        statement
-                            .execute_named(&[
-                                (":cmd", &command.command),
-                                (":cmd_tpl", &simplified_command.result.to_owned()),
-                                (":session_id", &"IMPORTED"),
-                                (":when_run", &command.when),
-                                (":exit_code", &0),
-                                (":selected", &0),
-                            ])
-                            .unwrap_or_else(|err| panic!("McFly error: Insert to work ({})", err));
+                        if let Err(e) = statement.execute_named(&[
+                            (":cmd", &command.command),
+                            (":cmd_tpl", &simplified_command.result.to_owned()),
+                            (":session_id", &"IMPORTED"),
+                            (":when_run", &command.when),
+                            (":exit_code", &0),
+                            (":selected", &0),
+                        ]) {
+                            println!("McFly error: Insert did not work ({})", e);
+                        }
                     }
                 }
             }

From f4eb38a7a8e50870ac146ceea4884625186942b1 Mon Sep 17 00:00:00 2001
From: Andrew Cantino <cantino@users.noreply.github.com>
Date: Thu, 17 Feb 2022 14:35:35 -0800
Subject: [PATCH 2/3] More verbose

---
 src/history/history.rs | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/history/history.rs b/src/history/history.rs
index b53b588..62bcf42 100644
--- a/src/history/history.rs
+++ b/src/history/history.rs
@@ -814,7 +814,10 @@ impl History {
                             (":exit_code", &0),
                             (":selected", &0),
                         ]) {
-                            println!("McFly error: Insert did not work ({})", e);
+                            println!(
+                                "Insert did not work due to '{}'. Command was '{}'",
+                                e, &command.command
+                            );
                         }
                     }
                 }

From 966170aa629ad1df7294b5734621371ebebcab6c Mon Sep 17 00:00:00 2001
From: Andrew Cantino <cantino@users.noreply.github.com>
Date: Sat, 19 Feb 2022 13:05:02 -0800
Subject: [PATCH 3/3] Better explanatory text

---
 src/history/history.rs | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/history/history.rs b/src/history/history.rs
index 62bcf42..66b2e62 100644
--- a/src/history/history.rs
+++ b/src/history/history.rs
@@ -815,7 +815,7 @@ impl History {
                             (":selected", &0),
                         ]) {
                             println!(
-                                "Insert did not work due to '{}'. Command was '{}'",
+                                "A single history line could not be saved due to '{}' (command was '{}'), but other inserts should be fine.",
                                 e, &command.command
                             );
                         }
