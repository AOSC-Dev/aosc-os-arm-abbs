abinfo "Configuring Subversion ..."
"$SRCDIR"/configure \
    --prefix=/usr \
    --with-apr=/usr \
    --with-apr-util=/usr \
    --with-zlib=/usr \
    --with-serf=/usr \
    --enable-apxs \
    --with-sqlite=/usr \
    --without-gnome-keyring \
    --without-kwallet \
    --disable-javahl \
    --disable-ruby \
    --with-apache-libexecdir=/usr/lib/httpd/modules \
    --disable-static \
    --enable-bdb6

abinfo "Building Subversion ..."
make LT_LDFLAGS="-L${PKGDIR}/usr/lib"

abinfo "Installing Subversion ..."
make install \
    DESTDIR="$PKGDIR"

if [[ "${CROSS:-$ARCH}" != "armv4" && \
      "${CROSS:-$ARCH}" != "armv6hf" && \
      "${CROSS:-$ARCH}" != "armv7hf" && \
      "${CROSS:-$ARCH}" != "i486" && \
      "${CROSS:-$ARCH}" != "loongson2f" && \
      "${CROSS:-$ARCH}" != "powerpc" && \
      "${CROSS:-$ARCH}" != "ppc64" ]]; then
    abinfo "Building Subversion bindings ..."
    make swig_pydir=/usr/lib/python2.7/site-packages/libsvn \
        swig_pydir_extra=/usr/lib/python2.7/site-packages/svn \
        OPTIMIZE="${CPPFLAGS} ${CFLAGS}" \
        OTHERLDFLAGS="${LDFLAGS}" swig-py swig-pl

    abinfo "Installing Subversion bindings ..."
    make install-swig-py install-swig-pl \
        DESTDIR="$PKGDIR" \
        swig_pydir=/usr/lib/python2.7/site-packages/libsvn \
        swig_pydir_extra=/usr/lib/python2.7/site-packages/svn
fi

abinfo "Installing hook scripts ..."
install -Dvm755 "$SRCDIR"/tools/hook-scripts/* \
    -t "$PKGDIR"/usr/share/subversion/hook-scripts || true
rm -fv "$PKGDIR"/usr/share/subversion/hook-scripts/*.in
