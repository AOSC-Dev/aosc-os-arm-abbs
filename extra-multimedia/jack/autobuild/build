if [[ "${CROSS:-$ARCH}" = "amd64" ]]; then
    export FFADO="--firewire"
fi

if [[ "${CROSS:-$ARCH}" != "armv4" && \
      "${CROSS:-$ARCH}" != "armv6hf" && \
      "${CROSS:-$ARCH}" != "armv7hf" && \
      "${CROSS:-$ARCH}" != "i486" && \
      "${CROSS:-$ARCH}" != "loongson2f" && \
      "${CROSS:-$ARCH}" != "powerpc" && \
      "${CROSS:-$ARCH}" != "ppc64" ]]; then
    export DOXYGEN="--doxygen"
fi

abinfo "Configuring JACK ..."
python3 "$SRCDIR"/waf \
    configure \
        --prefix=/usr \
        --alsa \
        --classic \
        --dbus \
        --systemd-unit \
        --clients 256 \
        --ports-per-application=2048 ${DOXYGEN} ${FFADO}

abinfo "Building JACK ..."
python3 "$SRCDIR"/waf build \
    -p \
    -j$(nproc)

abinfo "Installing JACK ..."
python3 "$SRCDIR"/waf install \
    --destdir="$PKGDIR"

abinfo "Setting executable bits for /usr/lib/*.so.* ..."
chmod -v +x "$PKGDIR"/usr/lib/*.so*
