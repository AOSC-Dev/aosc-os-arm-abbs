cd VulkanTools-sdk-$PKGVER
for i in glslang spirv-tools; do
    pushd external/$i
    mkdir build
    cd build
    cmake -DCMAKE_BUILD_TYPE=Release ..
    make
    make install
    popd
done

mkdir build
cd build

CMAKE_AFTER="-DBUILD_ICD=OFF -DBUILD_TESTS=OFF -DBUILD_DEMOS=ON"

cmake .. ${CMAKE_DEF} ${CMAKE_AFTER}
make
make install DESTDIR="$PKGDIR"

cd "$SRCDIR"/Vulkan-LoaderAndValidationLayers-sdk-$PKGVER

for i in glslang spirv-tools; do
    pushd external/$i
    mkdir build
    cd build
    cmake -DCMAKE_BUILD_TYPE=Release ..
    make
    make install
    popd
done

mkdir build
cd build

CMAKE_AFTER="-DBUILD_TESTS=OFF -DBUILD_WSI_XLIB_SUPPORT=ON -DBUILD_WSI_WAYLAND_SUPPORT=ON"

cmake .. ${CMAKE_DEF} ${CMAKE_AFTER}
make
make install DESTDIR="$PKGDIR"

cd "$SRCDIR"/VulkanTools-sdk-$PKGVER

install -dm755 "$PKGDIR"/usr/{bin,lib}
install -dm755 "$PKGDIR"/usr/share/vulkan/explicit_layer.d

install -m755 build/vktrace/{vkreplay,vktrace} "$PKGDIR"/usr/bin/
install -m755 build/vktrace/libVkLayer_vktrace_layer.so "$PKGDIR"/usr/lib/
install -m644 build/layersvt/*.so "$PKGDIR"/usr/lib

rm -v "$PKGDIR"/usr/share/vulkan/explicit_layer.d/VkLayer_basic_implicit.json

for i in layers/linux/*.json ; do
    sed 's@./@@' $i > "$PKGDIR"/usr/share/vulkan/explicit_layer.d/$(basename $i)
done

cd "$SRCDIR"/Vulkan-LoaderAndValidationLayers-sdk-$PKGVER

install -dm755 "$PKGDIR"/usr/{lib,include/vulkan}
install -dm755 "$PKGDIR"/etc/vulkan/icd.d/

cp -rv build/loader/libvulkan.so* "$PKGDIR"/usr/lib
install -m644 include/vulkan/vk_icd.h "$PKGDIR"/usr/include/vulkan/

install -dm755 "$PKGDIR"/usr/{bin,lib,include/vulkan}
install -dm755 "$PKGDIR"/usr/share/vulkan/{explicit,implicit}_layer.d

install -m755 build/demos/vulkaninfo "$PKGDIR"/usr/bin/
install -m644 build/layers/*.so "$PKGDIR"/usr/lib

install -m644 include/vulkan/* "$PKGDIR"/usr/include/vulkan/
rm "$PKGDIR"/usr/include/vulkan/{vulkan,vk_platform}.h
rm "$PKGDIR"/usr/include/vulkan/vk_icd.h
rm "$PKGDIR"/usr/include/vulkan/vulkan.hpp

for i in layers/linux/*.json ; do
    sed 's@./@@' $i > "$PKGDIR"/usr/share/vulkan/explicit_layer.d/$(basename $i)
done

cd "$SRCDIR"/Vulkan-Docs-1.0-core-20160826/doc/specs/vulkan
./makeKHR manpages
./makeKHR chunked

cd "$SRCDIR"/Vulkan-Docs-1.0-core-20160826

install -dm755 "$PKGDIR"/usr/include/vulkan
install -dm755 "$PKGDIR"/usr/share/vulkan

install -m644 src/vulkan/vk_platform.h "$PKGDIR"/usr/include/vulkan/
install -m644 src/vulkan/vulkan.h "$PKGDIR"/usr/include/vulkan
install -m644 src/spec/vk.xml "$PKGDIR"/usr/share/vulkan

install -dm755 "$PKGDIR/usr/share/man/man3"
install -m644 out/1.0/man/3/*.3 "$PKGDIR/usr/share/man/man3/"

install -dm755 "$PKGDIR/usr/share/doc/vulkan"
mv -v out/1.0/chunked/* "$PKGDIR/usr/share/doc/vulkan/"

cd "$SRCDIR"

rm -r "$PKGDIR"/var
