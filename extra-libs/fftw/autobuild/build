CONFIGURE="./configure F77=gfortran --prefix=/usr \
           --enable-shared --enable-threads \
           --enable-openmp"

if [[ "${CROSS:-$ARCH}" = "amd64" ]]; then
    CONF="--enable-sse3"
elif [[ "${CROSS:-$ARCH}" = "armel" || "${CROSS:-$ARCH}" = "arm64" ]]; then
    CONF="--enable-neon"
elif [[ "${CROSS:-$ARCH}" = "ppc64" ]]; then
    CONF="--enable-altivec"
fi

if [[ "${CROSS:-$ARCH}" = "amd64" ]]; then
    pushd fftw-3.3.4-double
    $CONFIGURE $CONF
    make
    make install DESTDIR="$PKGDIR"
    popd

    pushd fftw-3.3.4-long-double
    $CONFIGURE --enable-long-double \
               $CONF
    make
    make install DESTDIR="$PKGDIR"
    popd
fi

pushd fftw-3.3.4-single
$CONFIGURE --enable-float \
           $CONF
make
make install DESTDIR="$PKGDIR"
popd

if [[ "${CROSS:-$ARCH}" != "amd64" ]]; then
    pushd fftw-3.3.4-std
    $CONFIGURE
    make
    make install DESTDIR="$PKGDIR"
    popd
fi
