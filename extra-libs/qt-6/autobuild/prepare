abinfo "Preparing build environment ..."
export QTDIR="$SRCDIR"
export LD_LIBRARY_PATH="${QTDIR}/qtbase/lib:${QTDIR}/qttools/lib:${LD_LIBRARY_PATH}"
export QT_PLUGIN_PATH="${QTDIR}/qtbase/plugins"

if [[ "${CROSS:-$ARCH}" = "loongson3" || "${CROSS:-$ARCH}" = "ppc64el" ]]; then
    abinfo "FIXME: Skipping QtWebEngine on loongson3, ppc64el ..."
    NOMAKE="-skip qtwebengine"
fi

if [[ "${CROSS:-$ARCH}" = "amd64" ]]; then
    abinfo "Enabling SSE2, SSE3 optimisations on AMD64 ..."
    SSEOPT="-sse2 -sse3"
fi

abinfo "Configuring Qt 5 ..."
"$SRCDIR"/configure -confirm-license \
            -opensource \
            -prefix /usr \
            -bindir /usr/bin \
            -docdir /usr/share/doc/qt6 \
            -headerdir /usr/include/qt6 \
            -archdatadir /usr/lib/qt6 \
            -datadir /usr/share/qt6 \
            -sysconfdir /etc/xdg \
            -examplesdir /usr/share/doc/qt6/examples \
            -plugin-sql-psql \
            -plugin-sql-sqlite \
            -plugin-sql-odbc \
            -system-sqlite \
            -openssl-linked \
            -optimized-qmake \
            -dbus-linked \
            -system-harfbuzz \
            -journald \
            -libinput \
            -libproxy \
            -no-use-gold-linker \
            -feature-vulkan \
            -no-reduce-relocations \
            $NOMAKE $SSEOPT
