From 7db119850977f5fa37d6d5e8ed14c18e7fa2df13 Mon Sep 17 00:00:00 2001
From: "R. Bernstein" <rocky@gnu.org>
Date: Sat, 29 Jul 2017 20:47:00 -0400
Subject: [PATCH] Thomas Schmitt's fixes for Rock Ridge SUSP

See the thread in http://lists.gnu.org/archive/html/libcdio-devel/2017-07/msg00000.html
---
 lib/iso9660/iso9660_fs.c | 15 ++++++++++++++-
 lib/iso9660/rock.c       | 20 +-------------------
 2 files changed, 15 insertions(+), 20 deletions(-)

diff --git a/lib/iso9660/iso9660_fs.c b/lib/iso9660/iso9660_fs.c
index 8758a234..c528f1e8 100644
@@ -991,6 +991,19 @@ _fs_stat_traverse (const CdIo_t *p_cdio, const iso9660_stat_t *_root,
 
       if (!iso9660_get_dir_len(p_iso9660_dir))
 	{
+           /*
+
+	     libisofs of the libburnia project uses a directory
+	     record length of 0 as an indicator to advance to the next block
+	     start;  in this situtation the data size field of the directory
+	     indicates its end.
+
+             The formula does not exactly round up, as it increases "offset"
+             even if it encounters: (offset % ISO_BLOCKSIZE) == 0 .
+             In that case the block would be completely 0. Unplausible. But to go
+             on, it has to be skipped.
+           */
+	  offset += ISO_BLOCKSIZE - (offset % ISO_BLOCKSIZE);
 	  offset++;
 	  continue;
 	}
