From c576639e7e6bd9c7de0a288b9f94590d34ac9215 Mon Sep 17 00:00:00 2001
From: Oliver Giles <ohw.giles@gmail.com>
Date: Wed, 30 May 2018 20:38:24 +0300
Subject: [PATCH] resolves #47: invalid write in TNEFFillMapi

Don't pass 0 to calloc
---
 lib/ytnef.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/lib/ytnef.c b/lib/ytnef.c
index 5eb4204..dd0d6bd 100644
--- a/lib/ytnef.c
+++ b/lib/ytnef.c
@@ -479,6 +479,10 @@ int TNEFFillMapi(TNEFStruct *TNEF, BYTE *data, DWORD size, MAPIProps *p) {
         d += 4;
         count = 0;
       }
+      if (mp->count == 0) {
+        printf("ERROR: count==0 when filling MAPI property\n");
+        return -1;
+      }
       mp->data = calloc(mp->count, sizeof(variableLength));
       ALLOCCHECK(mp->data);
       vl = mp->data;
