abinfo "Installing systemd legacy tmpfiles.d configuration ..."
install -m644 "tmpfiles.d/legacy.conf" "$PKGDIR"/usr/lib/tmpfiles.d

abinfo "Setting permissions for /var/log/journal ..."
chown root:systemd-journal "$PKGDIR"/var/log/journal
chmod 2755 "$PKGDIR"/var/log/journal

abinfo "Creating default preset ..."
echo 'disable *' \
    > "$PKGDIR"/usr/lib/systemd/system-preset/99-default.preset

abinfo "Dropping unnecessary unit autostarts..."
for i in graphical.target.wants/systemd-update-utmp-runlevel.service \
         local-fs.target.wants/tmp.mount \
         multi-user.target.wants/{systemd-ask-password-wall.path,systemd-update-utmp-runlevel.service} \
         rescue.target.wants/systemd-update-utmp-runlevel.service \
         sysinit.target.wants/{dev-hugepages.mount,systemd-tmpfiles-setup.service} \
         sysinit.target.wants/{dev-mqueue.mount,sys-kernel-debug.mount,systemd-ask-password-console.path} \
         sysinit.target.wants/{ldconfig.service,systemd-binfmt.service,proc-sys-fs-binfmt_misc.automount} \
         sysinit.target.wants/{systemd-update-utmp.service,sys-fs-fuse-connections.mount}; do
    rm -fv "$PKGDIR"/usr/lib/systemd/system/${i}
done
