From fd430b24281ebe08af2f283a85a483c5033813c5 Mon Sep 17 00:00:00 2001
From: Mingcong Bai <jeffbai@aosc.io>
Date: Tue, 26 Mar 2024 18:49:24 +0800
Subject: [PATCH 64/64] drm/amdgpu: Call mmiowb() at the end of
 amdgpu_ring_commit()

Ref: https://github.com/chenhuacai/linux/commit/afef741ee09a65bf5f82fa30d0ffb027d16cc65e
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_ring.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_ring.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_ring.c
index 45424ebf9681..07143effc47a 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_ring.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_ring.c
@@ -150,6 +150,8 @@ void amdgpu_ring_commit(struct amdgpu_ring *ring)
 	mb();
 	amdgpu_ring_set_wptr(ring);
 
+	mmiowb(); /* Make sure wptr is up-to-date for hw */
+
 	if (ring->funcs->end_use)
 		ring->funcs->end_use(ring);
 }
-- 
2.44.0

