From 15007fd1df559c2cd80d97366f8bcf4687555c19 Mon Sep 17 00:00:00 2001
From: Ladislav Michl <ladis@linux-mips.org>
Date: Tue, 23 Jan 2024 12:46:32 +0100
Subject: [PATCH 2/7] FROM ARCHLINUX: Addon Manager: Qt6 fixes

---
 src/Mod/AddonManager/addonmanager_utilities.py | 4 ++--
 src/Mod/AddonManager/change_branch.py          | 2 +-
 src/Mod/AddonManager/package_details.py        | 7 +++----
 src/Mod/AddonManager/package_list.py           | 7 +++----
 4 files changed, 9 insertions(+), 11 deletions(-)

diff --git a/src/Mod/AddonManager/addonmanager_utilities.py b/src/Mod/AddonManager/addonmanager_utilities.py
index 5d71023d3414..140312eac056 100644
--- a/src/Mod/AddonManager/addonmanager_utilities.py
+++ b/src/Mod/AddonManager/addonmanager_utilities.py
@@ -36,7 +36,7 @@ from typing import Optional, Any
 from urllib.parse import urlparse
 
 try:
-    from PySide import QtCore, QtWidgets
+    from PySide import QtCore, QtGui, QtWidgets
 except ImportError:
     QtCore = None
     QtWidgets = None
@@ -245,7 +245,7 @@ def get_readme_html_url(repo):
 def is_darkmode() -> bool:
     """Heuristics to determine if we are in a darkmode stylesheet"""
     pl = fci.FreeCADGui.getMainWindow().palette()
-    return pl.color(pl.Background).lightness() < 128
+    return pl.color(QtGui.QPalette.Window).lightness() < 128
 
 
 def warning_color_string() -> str:
diff --git a/src/Mod/AddonManager/change_branch.py b/src/Mod/AddonManager/change_branch.py
index c31af0915f03..2453bc26f831 100644
--- a/src/Mod/AddonManager/change_branch.py
+++ b/src/Mod/AddonManager/change_branch.py
@@ -224,7 +224,7 @@ class ChangeBranchDialogModel(QtCore.QAbstractTableModel):
             dd = self.display_data[row]
             if column == 3 or column == 4:
                 if dd[column] is not None:
-                    qdate = QtCore.QDateTime.fromTime_t(dd[column])
+                    qdate = QtCore.QDateTime.fromSecsSinceEpoch(dd[column])
                     return QtCore.QLocale().toString(qdate, QtCore.QLocale.ShortFormat)
             elif column < len(dd):
                 return dd[column]
diff --git a/src/Mod/AddonManager/package_details.py b/src/Mod/AddonManager/package_details.py
index c9d1ae311a77..ec268960dfad 100644
--- a/src/Mod/AddonManager/package_details.py
+++ b/src/Mod/AddonManager/package_details.py
@@ -175,10 +175,9 @@ class PackageDetails(QtWidgets.QWidget):
             date = ""
             installed_version_string = "<h3>"
             if repo.updated_timestamp:
-                date = (
-                    QtCore.QDateTime.fromTime_t(repo.updated_timestamp)
-                    .date()
-                    .toString(QtCore.Qt.SystemLocaleShortDate)
+                date = QtCore.QLocale().toString(
+                    QtCore.QDateTime.fromSecsSinceEpoch(int(round(repo.updated_timestamp, 0))),
+                    QtCore.QLocale.ShortFormat,
                 )
             if version and date:
                 installed_version_string += (
diff --git a/src/Mod/AddonManager/package_list.py b/src/Mod/AddonManager/package_list.py
index 8629eaacb290..54c2ca7dd01a 100644
--- a/src/Mod/AddonManager/package_list.py
+++ b/src/Mod/AddonManager/package_list.py
@@ -489,10 +489,9 @@ class PackageListItemDelegate(QtWidgets.QStyledItemDelegate):
             installed_date_string = (
                 "<br/>" + translate("AddonsInstaller", "Installed on") + ": "
             )
-            installed_date_string += (
-                QtCore.QDateTime.fromTime_t(repo.updated_timestamp)
-                .date()
-                .toString(QtCore.Qt.SystemLocaleShortDate)
+            installed_date_string += QtCore.QLocale().toString(
+                QtCore.QDateTime.fromSecsSinceEpoch(int(round(repo.updated_timestamp, 0))),
+                QtCore.QLocale.ShortFormat,
             )
 
         available_version_string = ""
-- 
2.46.0

